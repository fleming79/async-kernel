
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Async-kernel for Jupyter">
      
      
      
        <link rel="canonical" href="https://fleming79.github.io/async-kernel/dev/reference/caller/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../comm/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>caller - async-kernel</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M11%209h2V7h-2m1%2013c-4.41%200-8-3.59-8-8s3.59-8%208-8%208%203.59%208%208-3.59%208-8%208m0-18A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202m-1%2015h2v-6h-2z%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#async_kernel.caller" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
               You're not
viewing the latest version.
<a href="../../..">
  <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="async-kernel" class="md-header__button md-logo" aria-label="async-kernel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            async-kernel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              caller
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="darkula" data-md-color-primary="blue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/fleming79/async-kernel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fleming79/async-kernel
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../usage/" class="md-tabs__link">
          
  
  
    
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 10h5.5L14 4.5zM5 3h10l6 6v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2m0 9v2h14v-2zm0 4v2h9v-2z"/></svg>
    
  
  Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/" class="md-tabs__link">
          
  
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="async-kernel" class="md-nav__button md-logo" aria-label="async-kernel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    async-kernel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fleming79/async-kernel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    fleming79/async-kernel
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usage/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 10h5.5L14 4.5zM5 3h10l6 6v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2m0 9v2h14v-2zm0 4v2h9v-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../notebooks/" class="md-nav__link ">
              
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 10h5.5L14 4.5zM5 3h10l6 6v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2m0 9v2h14v-2zm0 4v2h9v-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Notebooks
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/simple_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Simple example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/caller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caller
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/message_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Message handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    caller
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    caller
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;caller
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PendingGroup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup(shield)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;shield
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancellation_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;cancellation_timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;caller
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancel" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cancel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancelled" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cancelled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Caller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;MAX_IDLE_POOL_INSTANCES
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;IDLE_WORKER_SHUTDOWN_DURATION
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.stopped" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;stopped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;log
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.iopub_sockets" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;iopub_sockets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.iopub_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;iopub_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.id" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.backend_options" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;backend_options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;loop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.loop_options" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;loop_options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.protected" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;protected
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.zmq_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;zmq_context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.running" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;running
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.children" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.thread" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;thread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.parent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;parent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__new__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.start_sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;start_sync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.__asynccontextmanager__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__asynccontextmanager__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.id_current" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;id_current
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.get_existing" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_existing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.current_pending" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;current_pending
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.all_callers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;all_callers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.schedule_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;schedule_call
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_later" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_later
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_soon" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_soon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_direct" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_direct
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.to_thread" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_thread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_call
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_close" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_close
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;checkpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.as_completed" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_completed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.wait" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;wait
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.create_pending_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_pending_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../comm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    comm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    command
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    common
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debugger
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kernel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernelspec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kernelspec
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../asyncshell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    asyncshell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pending/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pending
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../event_loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    event_loop
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    typing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    License
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;caller
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PendingGroup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup(shield)" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-parameter"></code>&nbsp;shield
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancellation_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;cancellation_timeout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;caller
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancel" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cancel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.PendingGroup.cancelled" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cancelled
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" Caller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;MAX_IDLE_POOL_INSTANCES
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;IDLE_WORKER_SHUTDOWN_DURATION
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.stopped" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;stopped
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.log" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;log
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.iopub_sockets" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;iopub_sockets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.iopub_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;iopub_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.id" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;id
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;backend
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.backend_options" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;backend_options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.loop" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;loop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.loop_options" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;loop_options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.protected" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;protected
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.zmq_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;zmq_context
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.running" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;running
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.children" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.thread" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;thread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.parent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;parent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__new__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.start_sync" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;start_sync
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.__asynccontextmanager__" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__asynccontextmanager__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.id_current" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;id_current
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.get_existing" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_existing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.current_pending" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;current_pending
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.all_callers" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;all_callers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.schedule_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;schedule_call
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_later" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_later
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_soon" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_soon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.call_direct" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;call_direct
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.to_thread" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_thread
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_get" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_get
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_call" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_call
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.queue_close" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_close
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;checkpoint
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.as_completed" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;as_completed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.wait" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;wait
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async_kernel.caller.Caller.create_pending_group" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_pending_group
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Reference
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                  
                  


  
  


  <h1>caller</h1>

<div class="doc doc-object doc-module">



<a id="async_kernel.caller"></a>
    <div class="doc doc-contents first">

          









<p><span class="doc-section-title">Classes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" PendingGroup (async_kernel.caller.PendingGroup)" href="#async_kernel.caller.PendingGroup">PendingGroup</a></code></b>
          –
          <div class="doc-md-description">
            <p>An asynchronous context manager for tracking <a class="autorefs autorefs-internal" title=" Pending" href="../pending/#async_kernel.pending.Pending">async_kernel.pending.Pending</a> created in the context.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" Caller (async_kernel.caller.Caller)" href="#async_kernel.caller.Caller">Caller</a></code></b>
          –
          <div class="doc-md-description">
            <p>Caller is an advanced asynchronous context manager and scheduler for managing function calls within an async kernel environment.</p>
          </div>
        </li>
    </ul>







<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="async_kernel.caller.PendingGroup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">PendingGroup</span>


<a href="#async_kernel.caller.PendingGroup" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a></code>, <code><a class="autorefs autorefs-external" title="anyio.AsyncContextManagerMixin" href="https://anyio.readthedocs.io/en/stable/api.html#anyio.AsyncContextManagerMixin">AsyncContextManagerMixin</a></code></p>



        <p>An asynchronous context manager for tracking <a class="autorefs autorefs-internal" title=" Pending" href="../pending/#async_kernel.pending.Pending">async_kernel.pending.Pending</a> created in the context.</p>
<p>If any pending is set with an exception, the pending group and all tracked pending
will be cancelled. The context will exit once all registered pending are complete or
when after the <a class="autorefs autorefs-internal" title=" cancellation_timeout" href="../pending/#async_kernel.pending.PendingGroup.cancellation_timeout">cancellation_timeout</a> period has elapsed.</p>


<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>The context will exit after all tracked pending are done or removed.</li>
<li>Cancelled or failed pending will cancel all other pending in the group.</li>
<li>Pending can be manually removed from the group while the group is active.</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h3 id="async_kernel.caller.PendingGroup(shield)" class="doc doc-heading doc-heading-parameter">              <b><code>shield</code></b>
<a href="#async_kernel.caller.PendingGroup(shield)" class="headerlink" title="Permanent link">&para;</a></h3>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p><a class="autorefs autorefs-external" href="https://anyio.readthedocs.io/en/stable/api.html#anyio.CancelScope.shield">Shield</a> from external cancellation.</p>
          </div>
        </li>
    </ul>


<details class="usage" open>
  <summary>Usage</summary>
  <p>Enter the async context and create new pending.</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">with</span> <span class="n">PendingGroup</span><span class="p">()</span> <span class="k">as</span> <span class="n">pg</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">pg</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pg</span><span class="o">.</span><span class="n">pending</span>
</code></pre></div>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller.create_pending_group"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_pending_group</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../pending/#">pending</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../pending/#async_kernel.pending.Pending"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Pending</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../pending/#async_kernel.pending.Pending.trackers"><code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;trackers</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

  </div>












<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" cancel (async_kernel.caller.PendingGroup.cancel)" href="#async_kernel.caller.PendingGroup.cancel">cancel</a></code></b>
            –
            <div class="doc-md-description">
              <p>Cancel the pending group (thread-safe).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" cancelled (async_kernel.caller.PendingGroup.cancelled)" href="#async_kernel.caller.PendingGroup.cancelled">cancelled</a></code></b>
            –
            <div class="doc-md-description">
              <p>Return True if the pending group is cancelled.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" cancellation_timeout (async_kernel.caller.PendingGroup.cancellation_timeout)" href="#async_kernel.caller.PendingGroup.cancellation_timeout">cancellation_timeout</a></code></b>
          –
          <div class="doc-md-description">
            <p>The maximum time to wait for cancelled pending to be done.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" caller (async_kernel.caller.PendingGroup.caller)" href="#async_kernel.caller.PendingGroup.caller">caller</a></code></b>
              (<code><a class="autorefs autorefs-internal" title=" Fixed (async_kernel.common.Fixed)" href="../common/#async_kernel.common.Fixed">Fixed</a>[<a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a>, <a class="autorefs autorefs-internal" title=" Caller (async_kernel.caller.Caller)" href="#async_kernel.caller.Caller">Caller</a>]</code>)
          –
          <div class="doc-md-description">
            <p>The caller where the pending group was instantiated.</p>
          </div>
        </li>
    </ul>

              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/async_kernel/pending.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PendingGroup</span><span class="p">(</span><span class="n">PendingTracker</span><span class="p">,</span> <span class="n">anyio</span><span class="o">.</span><span class="n">AsyncContextManagerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An asynchronous context manager for tracking [async_kernel.pending.Pending][] created in the context.</span>

<span class="sd">    If any pending is set with an exception, the pending group and all tracked pending</span>
<span class="sd">    will be cancelled. The context will exit once all registered pending are complete or</span>
<span class="sd">    when after the [cancellation_timeout][] period has elapsed.</span>

<span class="sd">    Features:</span>
<span class="sd">        - The context will exit after all tracked pending are done or removed.</span>
<span class="sd">        - Cancelled or failed pending will cancel all other pending in the group.</span>
<span class="sd">        - Pending can be manually removed from the group while the group is active.</span>

<span class="sd">    Args:</span>
<span class="sd">        shield: [Shield][anyio.CancelScope.shield] from external cancellation.</span>

<span class="sd">    Usage:</span>
<span class="sd">        Enter the async context and create new pending.</span>

<span class="sd">        ```python</span>
<span class="sd">        async with PendingGroup() as pg:</span>
<span class="sd">            assert pg.caller.to_thread(lambda: None) in pg.pending</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_parent_id</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_cancel_scope</span><span class="p">:</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span>
    <span class="n">_cancelled</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_leaving_context</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_failed</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Pending</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">cancellation_timeout</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="s2">&quot;The maximum time to wait for cancelled pending to be done.&quot;</span>

    <span class="n">caller</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">Caller</span><span class="p">]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">async_kernel</span><span class="o">.</span><span class="n">Caller</span><span class="p">())</span>
    <span class="s2">&quot;The caller where the pending group was instantiated.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">shield</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>  <span class="c1"># noqa: B018</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shield</span> <span class="o">=</span> <span class="n">shield</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="nd">@override</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_activate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Token</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent_id</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id_contextvar</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="n">parent_id</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_activate</span><span class="p">()</span>

    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__asynccontextmanager__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaving_context</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Re-entry of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2"> is not supported!&quot;</span>
            <span class="k">raise</span> <span class="n">InvalidStateError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span> <span class="o">=</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_shield</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span> <span class="o">=</span> <span class="n">create_async_event</span><span class="p">()</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activate</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="bp">self</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_leaving_context</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">anyio</span><span class="o">.</span><span class="n">get_cancelled_exc_class</span><span class="p">(),</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">exceptions</span> <span class="o">:=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_failed</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span> <span class="o">:=</span> <span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">(),</span> <span class="ne">Exception</span><span class="p">)]:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;One or more exceptions occurred in this context!&quot;</span>
                    <span class="k">raise</span> <span class="n">ExceptionGroup</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">PendingCancelled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_leaving_context</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_deactivate</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span> <span class="o">=</span> <span class="n">create_async_event</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">anyio</span><span class="o">.</span><span class="n">move_on_after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cancellation_timeout</span><span class="p">):</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span>

    <span class="nd">@override</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="p">:</span> <span class="n">Pending</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pen</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_pending_done</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">id_</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parent</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id_</span><span class="p">)):</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>

    <span class="nd">@override</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_on_pending_done</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="p">:</span> <span class="n">Pending</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_failed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in member: </span><span class="si">{</span><span class="n">pen</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaving_context</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_done</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="nd">@enable_signal_safety</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="s2">&quot;Cancel the pending group (thread-safe).&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="n">cancel_called</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">call_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pen_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">:</span>
                <span class="n">pen_</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the pending group is cancelled.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.PendingGroup.cancellation_timeout" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">cancellation_timeout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.PendingGroup.cancellation_timeout" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">cancellation_timeout</span> <span class="o">=</span> <span class="mi">10</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The maximum time to wait for cancelled pending to be done.</p>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.PendingGroup"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../pending/#">pending</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../pending/#async_kernel.pending.PendingGroup"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

  </div>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.PendingGroup.caller" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">caller</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.PendingGroup.caller" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">caller</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title=" Fixed (async_kernel.common.Fixed)" href="../common/#async_kernel.common.Fixed">Fixed</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title=" Caller (async_kernel.caller.Caller)" href="#async_kernel.caller.Caller">Caller</a></span><span class="p">]</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title=" Fixed (async_kernel.common.Fixed)" href="../common/#async_kernel.common.Fixed">Fixed</a></span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n"><span title="async_kernel.Caller">Caller</span></span><span class="p">())</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The caller where the pending group was instantiated.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.PendingGroup.cancel" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">cancel</span>


<a href="#async_kernel.caller.PendingGroup.cancel" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">cancel</span><span class="p">(</span><span class="n"><span title="async_kernel.caller.PendingGroup.cancel(msg)">msg</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Cancel the pending group (thread-safe).</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/pending.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@enable_signal_safety</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s2">&quot;Cancel the pending group (thread-safe).&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="n">cancel_called</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">call_direct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pen_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending</span><span class="p">:</span>
            <span class="n">pen_</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.PendingGroup.cancelled" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">cancelled</span>


<a href="#async_kernel.caller.PendingGroup.cancelled" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">cancelled</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return True if the pending group is cancelled.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/pending.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the pending group is cancelled.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="async_kernel.caller.Caller" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Caller</span>


<a href="#async_kernel.caller.Caller" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="anyio.AsyncContextManagerMixin" href="https://anyio.readthedocs.io/en/stable/api.html#anyio.AsyncContextManagerMixin">AsyncContextManagerMixin</a></code></p>



        <p>Caller is an advanced asynchronous context manager and scheduler for managing function calls within an async kernel environment.</p>


<details class="features" open>
  <summary>Features</summary>
  <ul>
<li>Manages a pool of worker threads and async contexts for efficient scheduling and execution.</li>
<li>Supports synchronous and asynchronous startup, shutdown, and cleanup of idle workers.</li>
<li>Provides thread-safe scheduling of functions (sync/async), with support for delayed and queued execution.</li>
<li>Integrates with ZeroMQ (zmq) for PUB socket communication.</li>
<li>Tracks child caller instances, enabling hierarchical shutdown and resource management.</li>
<li>Offers mechanisms for direct calls, queued calls, and thread offloading.</li>
<li>Implements <code>as_completed</code> and <code>wait</code> utilities for monitoring and collecting results from scheduled tasks.</li>
<li>Handles cancellation, exceptions, and context propagation robustly.</li>
</ul>
</details>

<details class="usage" open>
  <summary>Usage</summary>
  <ul>
<li>Use Caller to manage async/sync function execution, worker threads, and task scheduling in complex async applications.</li>
<li>Integrate with ZeroMQ for PUB socket communication.</li>
<li>Leverage child management for hierarchical resource cleanup.</li>
<li>Use <code>as_completed</code> and <code>wait</code> for efficient result collection and monitoring.</li>
</ul>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../#reference">Reference</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../#highlights">Highlights</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../asyncshell/#">asyncshell</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../asyncshell/#async_kernel.asyncshell.KernelMagics"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;KernelMagics</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../typing/#">typing</a>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.CallerCreateOptions"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CallerCreateOptions</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.CallerState"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;CallerState</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing"><code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;typing</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#usage">Usage</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/#caller">Caller</a>
  </span>

      </li>
  </ul>

        <b class="doc doc-backlink-type">Returned by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller.all_callers"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;all_callers</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.PendingGroup"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.PendingGroup.caller"><code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;caller</a>
  </span>

      </li>
  </ul>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../interface/#">interface</a>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../interface/#async_kernel.interface.BaseKernelInterface"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseKernelInterface</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../interface/#async_kernel.interface.BaseKernelInterface.callers"><code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;callers</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../interface/#async_kernel.interface.base.BaseKernelInterface"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;BaseKernelInterface</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../interface/#async_kernel.interface.base.BaseKernelInterface.callers"><code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;callers</a>
  </span>

      </li>
  </ul>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../pending/#">pending</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../pending/#async_kernel.pending.PendingGroup"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PendingGroup</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../pending/#async_kernel.pending.PendingGroup.caller"><code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;caller</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

  </div>












<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" __new__ (async_kernel.caller.Caller.__new__)" href="#async_kernel.caller.Caller.__new__">__new__</a></code></b>
            –
            <div class="doc-md-description">
              <p>Create or retrieve a Caller instance.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" start_sync (async_kernel.caller.Caller.start_sync)" href="#async_kernel.caller.Caller.start_sync">start_sync</a></code></b>
            –
            <div class="doc-md-description">
              <p>Start synchronously.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" stop (async_kernel.caller.Caller.stop)" href="#async_kernel.caller.Caller.stop">stop</a></code></b>
            –
            <div class="doc-md-description">
              <p>Stop the caller cancelling all incomplete tasks.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" __asynccontextmanager__ (async_kernel.caller.Caller.__asynccontextmanager__)" href="#async_kernel.caller.Caller.__asynccontextmanager__">__asynccontextmanager__</a></code></b>
            –
            <div class="doc-md-description">
              <p>The asynchronous context for caller.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" id_current (async_kernel.caller.Caller.id_current)" href="#async_kernel.caller.Caller.id_current">id_current</a></code></b>
            –
            <div class="doc-md-description">
              <p>The id that is used for a caller for the current thread in CPython or context in Pyodide.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" get_existing (async_kernel.caller.Caller.get_existing)" href="#async_kernel.caller.Caller.get_existing">get_existing</a></code></b>
            –
            <div class="doc-md-description">
              <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> to get the caller instance from the corresponding thread if it exists.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" current_pending (async_kernel.caller.Caller.current_pending)" href="#async_kernel.caller.Caller.current_pending">current_pending</a></code></b>
            –
            <div class="doc-md-description">
              <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> that returns the current result when called from inside a function scheduled by Caller.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" all_callers (async_kernel.caller.Caller.all_callers)" href="#async_kernel.caller.Caller.all_callers">all_callers</a></code></b>
            –
            <div class="doc-md-description">
              <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> to get a list of the callers.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" get (async_kernel.caller.Caller.get)" href="#async_kernel.caller.Caller.get">get</a></code></b>
            –
            <div class="doc-md-description">
              <p>Retrieves an existing child caller by name and backend, or creates a new one if not found.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" schedule_call (async_kernel.caller.Caller.schedule_call)" href="#async_kernel.caller.Caller.schedule_call">schedule_call</a></code></b>
            –
            <div class="doc-md-description">
              <p>Schedule <code>func</code> to be called inside a task running in the callers thread (thread-safe).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" call_later (async_kernel.caller.Caller.call_later)" href="#async_kernel.caller.Caller.call_later">call_later</a></code></b>
            –
            <div class="doc-md-description">
              <p>Schedule func to be called in caller's event loop copying the current context.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" call_soon (async_kernel.caller.Caller.call_soon)" href="#async_kernel.caller.Caller.call_soon">call_soon</a></code></b>
            –
            <div class="doc-md-description">
              <p>Schedule func to be called in caller's event loop copying the current context.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" call_direct (async_kernel.caller.Caller.call_direct)" href="#async_kernel.caller.Caller.call_direct">call_direct</a></code></b>
            –
            <div class="doc-md-description">
              <p>Schedule <code>func</code> to be called in caller's event loop directly.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" to_thread (async_kernel.caller.Caller.to_thread)" href="#async_kernel.caller.Caller.to_thread">to_thread</a></code></b>
            –
            <div class="doc-md-description">
              <p>Call func in a worker thread using the same backend as the current instance.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" queue_get (async_kernel.caller.Caller.queue_get)" href="#async_kernel.caller.Caller.queue_get">queue_get</a></code></b>
            –
            <div class="doc-md-description">
              <p>Returns <code>Pending</code> instance for <code>func</code> where the queue is running.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" queue_call (async_kernel.caller.Caller.queue_call)" href="#async_kernel.caller.Caller.queue_call">queue_call</a></code></b>
            –
            <div class="doc-md-description">
              <p>Queue the execution of <code>func</code> in a queue unique to it and the caller instance (thread-safe).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" queue_close (async_kernel.caller.Caller.queue_close)" href="#async_kernel.caller.Caller.queue_close">queue_close</a></code></b>
            –
            <div class="doc-md-description">
              <p>Close the execution queue associated with <code>func</code> (thread-safe).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" checkpoint (async_kernel.caller.Caller.checkpoint)" href="#async_kernel.caller.Caller.checkpoint">checkpoint</a></code></b>
            –
            <div class="doc-md-description">
              <p>Yield to the event loop.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" as_completed (async_kernel.caller.Caller.as_completed)" href="#async_kernel.caller.Caller.as_completed">as_completed</a></code></b>
            –
            <div class="doc-md-description">
              <p>An iterator to get result as they complete.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" wait (async_kernel.caller.Caller.wait)" href="#async_kernel.caller.Caller.wait">wait</a></code></b>
            –
            <div class="doc-md-description">
              <p>Wait for the results given by items to complete.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title=" create_pending_group (async_kernel.caller.Caller.create_pending_group)" href="#async_kernel.caller.Caller.create_pending_group">create_pending_group</a></code></b>
            –
            <div class="doc-md-description">
              <p>Create a new <a class="autorefs autorefs-internal" title=" PendingGroup" href="../pending/#async_kernel.pending.PendingGroup">PendingGroup</a> instance.</p>
            </div>
          </li>
    </ul>




<p><span class="doc-section-title">Attributes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" MAX_IDLE_POOL_INSTANCES (async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES)" href="#async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES">MAX_IDLE_POOL_INSTANCES</a></code></b>
          –
          <div class="doc-md-description">
            <p>The number of <code>pool</code> instances to leave idle (See also <a class="autorefs autorefs-internal" title=" to_thread" href="#async_kernel.caller.Caller.to_thread">to_thread</a>).</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" IDLE_WORKER_SHUTDOWN_DURATION (async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION)" href="#async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION">IDLE_WORKER_SHUTDOWN_DURATION</a></code></b>
          –
          <div class="doc-md-description">
            <p>The minimum duration in seconds for a worker to remain in the worker pool before it is shutdown.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" stopped (async_kernel.caller.Caller.stopped)" href="#async_kernel.caller.Caller.stopped">stopped</a></code></b>
          –
          <div class="doc-md-description">
            <p>A thread-safe Event for when the caller is stopped.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" log (async_kernel.caller.Caller.log)" href="#async_kernel.caller.Caller.log">log</a></code></b>
              (<code><a class="autorefs autorefs-external" title="logging.LoggerAdapter" href="https://docs.python.org/3/library/logging.html#logging.LoggerAdapter">LoggerAdapter</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]</code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" iopub_sockets (async_kernel.caller.Caller.iopub_sockets)" href="#async_kernel.caller.Caller.iopub_sockets">iopub_sockets</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <span title="zmq.Socket">Socket</span>]</code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" iopub_url (async_kernel.caller.Caller.iopub_url)" href="#async_kernel.caller.Caller.iopub_url">iopub_url</a></code></b>
              (<code><a class="autorefs autorefs-external" title="typing.ClassVar" href="https://docs.python.org/3/library/typing.html#typing.ClassVar">ClassVar</a></code>)
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" name (async_kernel.caller.Caller.name)" href="#async_kernel.caller.Caller.name">name</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
          –
          <div class="doc-md-description">
            <p>The name of the thread when the caller was created.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" id (async_kernel.caller.Caller.id)" href="#async_kernel.caller.Caller.id">id</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            <p>The id for the caller.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" backend (async_kernel.caller.Caller.backend)" href="#async_kernel.caller.Caller.backend">backend</a></code></b>
              (<code><a class="autorefs autorefs-internal" title=" Backend (async_kernel.typing.Backend)" href="../typing/#async_kernel.typing.Backend">Backend</a></code>)
          –
          <div class="doc-md-description">
            <p>The backend used by caller.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" backend_options (async_kernel.caller.Caller.backend_options)" href="#async_kernel.caller.Caller.backend_options">backend_options</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a> | None</code>)
          –
          <div class="doc-md-description">
            <p>Options used to create the backend.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" loop (async_kernel.caller.Caller.loop)" href="#async_kernel.caller.Caller.loop">loop</a></code></b>
              (<code><a class="autorefs autorefs-internal" title=" Loop (async_kernel.typing.Loop)" href="../typing/#async_kernel.typing.Loop">Loop</a> | None</code>)
          –
          <div class="doc-md-description">
            <p>The gui event loop if there is one.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" loop_options (async_kernel.caller.Caller.loop_options)" href="#async_kernel.caller.Caller.loop_options">loop_options</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a> | None</code>)
          –
          <div class="doc-md-description">
            <p>Options used to create the gui event loop.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" protected (async_kernel.caller.Caller.protected)" href="#async_kernel.caller.Caller.protected">protected</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
          –
          <div class="doc-md-description">
            <p>Returns <code>True</code> if the caller is protected from stopping.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" zmq_context (async_kernel.caller.Caller.zmq_context)" href="#async_kernel.caller.Caller.zmq_context">zmq_context</a></code></b>
              (<code><span title="zmq.Context">Context</span> | None</code>)
          –
          <div class="doc-md-description">
            <p>A zmq socket, which if present indicates that an iopub socket is loaded.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" running (async_kernel.caller.Caller.running)" href="#async_kernel.caller.Caller.running">running</a></code></b>
          –
          <div class="doc-md-description">
            <p>Returns <code>True</code> when the caller is available to run requests.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" children (async_kernel.caller.Caller.children)" href="#async_kernel.caller.Caller.children">children</a></code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#frozenset">frozenset</a>[<a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a>]</code>)
          –
          <div class="doc-md-description">
            <p>A frozenset copy of the instances that were created by the caller.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" thread (async_kernel.caller.Caller.thread)" href="#async_kernel.caller.Caller.thread">thread</a></code></b>
              (<code><a class="autorefs autorefs-external" title="threading.Thread" href="https://docs.python.org/3/library/threading.html#threading.Thread">Thread</a></code>)
          –
          <div class="doc-md-description">
            <p>The thread where the caller is running.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title=" parent (async_kernel.caller.Caller.parent)" href="#async_kernel.caller.Caller.parent">parent</a></code></b>
              (<code><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a> | None</code>)
          –
          <div class="doc-md-description">
            <p>The parent caller if it exists.</p>
          </div>
        </li>
    </ul>

              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Caller</span><span class="p">(</span><span class="n">anyio</span><span class="o">.</span><span class="n">AsyncContextManagerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Caller is an advanced asynchronous context manager and scheduler for managing function calls within an async kernel environment.</span>

<span class="sd">    Features:</span>
<span class="sd">        - Manages a pool of worker threads and async contexts for efficient scheduling and execution.</span>
<span class="sd">        - Supports synchronous and asynchronous startup, shutdown, and cleanup of idle workers.</span>
<span class="sd">        - Provides thread-safe scheduling of functions (sync/async), with support for delayed and queued execution.</span>
<span class="sd">        - Integrates with ZeroMQ (zmq) for PUB socket communication.</span>
<span class="sd">        - Tracks child caller instances, enabling hierarchical shutdown and resource management.</span>
<span class="sd">        - Offers mechanisms for direct calls, queued calls, and thread offloading.</span>
<span class="sd">        - Implements `as_completed` and `wait` utilities for monitoring and collecting results from scheduled tasks.</span>
<span class="sd">        - Handles cancellation, exceptions, and context propagation robustly.</span>

<span class="sd">    Usage:</span>
<span class="sd">        - Use Caller to manage async/sync function execution, worker threads, and task scheduling in complex async applications.</span>
<span class="sd">        - Integrate with ZeroMQ for PUB socket communication.</span>
<span class="sd">        - Leverage child management for hierarchical resource cleanup.</span>
<span class="sd">        - Use `as_completed` and `wait` for efficient result collection and monitoring.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MAX_IDLE_POOL_INSTANCES</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="s2">&quot;The number of `pool` instances to leave idle (See also [to_thread][async_kernel.caller.Caller.to_thread]).&quot;</span>
    <span class="n">IDLE_WORKER_SHUTDOWN_DURATION</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s2">&quot;pytest&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span> <span class="k">else</span> <span class="mi">60</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The minimum duration in seconds for a worker to remain in the worker pool before it is shutdown.</span>

<span class="sd">    Set to 0 to disable (default when running tests).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CALLER_MAIN_THREAD_ID</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">main_thread</span><span class="p">())</span>

    <span class="n">_caller_token</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;caller_tokens&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">CALLER_MAIN_THREAD_ID</span><span class="p">)</span>
    <span class="n">_instances</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Self</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_lock</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="n">BinarySemaphore</span><span class="p">()</span>

    <span class="n">_thread</span><span class="p">:</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span>
    <span class="n">_caller_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_idle_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">_backend</span><span class="p">:</span> <span class="n">Backend</span>
    <span class="n">_backend_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">_loop</span><span class="p">:</span> <span class="n">Loop</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">_loop_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">_protected</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_use_safe_checkpoint</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_state</span><span class="p">:</span> <span class="n">CallerState</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span>
    <span class="n">_state_reprs</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span><span class="p">:</span> <span class="s2">&quot;❗ not running&quot;</span><span class="p">,</span>
        <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">:</span> <span class="s2">&quot;starting sync&quot;</span><span class="p">,</span>
        <span class="n">CallerState</span><span class="o">.</span><span class="n">running</span><span class="p">:</span> <span class="s2">&quot;🏃 running&quot;</span><span class="p">,</span>
        <span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span><span class="p">:</span> <span class="s2">&quot;🏁 stopping&quot;</span><span class="p">,</span>
        <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span><span class="p">:</span> <span class="s2">&quot;🏁 stopped&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_zmq_context</span><span class="p">:</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_parent_ref</span><span class="p">:</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">[</span><span class="n">Self</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Fixed</span>
    <span class="n">_child_lock</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="n">BinarySemaphore</span><span class="p">)</span>
    <span class="n">_children</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="n">Self</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">_tasks</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="n">_worker_pool</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">deque</span><span class="p">[</span><span class="n">Self</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
    <span class="n">_queue_map</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Pending</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">_queue</span><span class="p">:</span> <span class="n">Fixed</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">[</span><span class="n">Pending</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">(</span>
            <span class="n">c</span><span class="p">[</span><span class="s2">&quot;owner&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">reject</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Pending</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s2">&quot;The caller has been closed&quot;</span><span class="p">,</span> <span class="n">_force</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">stopped</span> <span class="o">=</span> <span class="n">Fixed</span><span class="p">(</span><span class="n">Event</span><span class="p">)</span>
    <span class="s2">&quot;A thread-safe Event for when the caller is stopped.&quot;</span>

    <span class="n">_pending_var</span><span class="p">:</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">[</span><span class="n">Pending</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;_pending_var&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">log</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
    <span class="s2">&quot;&quot;</span>
    <span class="n">iopub_sockets</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Socket</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="s2">&quot;&quot;</span>
    <span class="n">iopub_url</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="s2">&quot;inproc://iopub&quot;</span>
    <span class="s2">&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="s2">&quot;The name of the thread when the caller was created.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="s2">&quot;The id for the caller.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Backend</span><span class="p">:</span>
        <span class="s2">&quot;The backend used by caller.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">backend_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;Options used to create the backend.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Loop</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;The gui event loop if there is one.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;Options used to create the gui event loop.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop_options</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">protected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="s2">&quot;Returns `True` if the caller is protected from stopping.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_protected</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">zmq_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;A zmq socket, which if present indicates that an iopub socket is loaded.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns `True` when the caller is available to run requests.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">running</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">frozenset</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A frozenset copy of the instances that were created by the caller.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - When the parent is stopped, all children are stopped.</span>
<span class="sd">            - All children are stopped prior to the parent exiting its async context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">thread</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">:</span>
        <span class="s2">&quot;The thread where the caller is running.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;The parent caller if it exists.&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ref</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_ref</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">inst</span> <span class="o">:=</span> <span class="n">ref</span><span class="p">())</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inst</span><span class="o">.</span><span class="n">stopped</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inst</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@override</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;1 child&quot;</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> children&quot;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Caller&lt;</span><span class="si">{</span><span class="n">info</span><span class="si">!s}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state_reprs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">children</span><span class="si">}</span><span class="s2">&gt;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">modifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span> <span class="s2">&quot;MainThread&quot;</span><span class="p">,</span> <span class="s2">&quot;NewThread&quot;</span><span class="p">,</span> <span class="s2">&quot;manual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">CallerCreateOptions</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create or retrieve a Caller instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            modifier: Specifies how the Caller instance should be created or retrieved.</span>

<span class="sd">                - &quot;CurrentThread&quot;: Automatically create or retrieve the instance.</span>
<span class="sd">                - &quot;MainThread&quot;: Use the main thread for the Caller.</span>
<span class="sd">                - &quot;NewThread&quot;: Create a new thread.</span>
<span class="sd">                - &quot;manual&quot;: Manually create a new instance for the current thread.</span>

<span class="sd">            **kwargs: Additional options for Caller creation, such as:</span>
<span class="sd">                - name: The name to use.</span>
<span class="sd">                - backend: The async backend to use.</span>
<span class="sd">                - backend_options: Options for the backend.</span>
<span class="sd">                - protected: Whether the Caller is protected.</span>
<span class="sd">                - zmq_context: ZeroMQ context.</span>
<span class="sd">                - log: Logger instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self: The created or retrieved Caller instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the backend is not provided and backend can&#39;t be determined.</span>
<span class="sd">            ValueError: If the thread and caller&#39;s name do not match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">)</span>
            <span class="k">match</span> <span class="n">modifier</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;CurrentThread&quot;</span> <span class="o">|</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
                    <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_current</span><span class="p">()</span>
                <span class="k">case</span> <span class="s2">&quot;MainThread&quot;</span><span class="p">:</span>
                    <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">CALLER_MAIN_THREAD_ID</span>
                <span class="k">case</span> <span class="s2">&quot;NewThread&quot;</span><span class="p">:</span>
                    <span class="n">caller_id</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Locate existing</span>
            <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">caller</span> <span class="o">:=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">caller_id</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An instance already exists for </span><span class="si">{</span><span class="n">caller_id</span><span class="si">=}</span><span class="s2">&quot;</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The thread and caller&#39;s name do not match! </span><span class="si">{</span><span class="n">name</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="si">=}</span><span class="s2">&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">backend</span> <span class="ow">and</span> <span class="n">backend</span> <span class="o">!=</span> <span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The backend does not match! </span><span class="si">{</span><span class="n">backend</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="si">=}</span><span class="s2">&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">caller</span>

            <span class="c1"># create a new instance</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">backend</span> <span class="ow">or</span> <span class="n">current_async_library</span><span class="p">())</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">Loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">loop</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_backend_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend_options&quot;</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_loop_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop_options&quot;</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_protected</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protected&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_zmq_context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zmq_context&quot;</span><span class="p">)</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;emscripten&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">caller_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">caller_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span> <span class="o">=</span> <span class="n">caller_id</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>

            <span class="c1"># finalize</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
                <span class="n">inst</span><span class="o">.</span><span class="n">start_sync</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span>
            <span class="k">assert</span> <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;Start synchronously.&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_caller_in_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span>
                <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_caller_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># An event loop for the current thread.</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="n">Backend</span><span class="o">.</span><span class="n">asyncio</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">run_caller_in_context</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># trio</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">current_token</span><span class="p">()</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">to_thread</span><span class="p">():</span>
                    <span class="n">utils</span><span class="o">.</span><span class="n">mark_thread_pydev_do_not_trace</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">anyio</span><span class="o">.</span><span class="n">from_thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_caller_in_context</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>
                    <span class="k">except</span> <span class="p">(</span><span class="n">BaseExceptionGroup</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;shutdown&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                            <span class="k">raise</span>

                <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">to_thread</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;async_kernel_caller&quot;</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">RunSettings</span><span class="p">(</span>
                <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
                <span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span>
                <span class="n">backend_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend_options</span><span class="p">,</span>
                <span class="n">loop_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_options</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">run_caller_in_context</span><span class="p">,</span> <span class="p">(),</span> <span class="n">settings</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">async_kernel</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallerState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the caller cancelling all incomplete tasks.</span>

<span class="sd">        Args:</span>
<span class="sd">            force: If the caller is protected the call is a no-op unless force=True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_protected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
        <span class="n">set_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue_close</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">set_stop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__asynccontextmanager__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
        <span class="s2">&quot;The asynchronous context for caller.&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Already starting! Did you mean to use Caller(&quot;manual&quot;)?&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Caller cannot be been re-entered!&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">create_task_group</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>
            <span class="n">socket</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">running</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">start_soon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scheduler</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">,</span> <span class="n">tg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="p">:</span>
                <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># zmq.SocketType.PUB</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">linger</span> <span class="o">=</span> <span class="mi">50</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iopub_url</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iopub_sockets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">socket</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">iopub_sockets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">stopped</span>
                    <span class="k">if</span> <span class="n">parent</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                        <span class="n">parent</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_scheduler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">,</span> <span class="n">tg</span><span class="p">:</span> <span class="n">TaskGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous scheduler coroutine responsible for managing and executing tasks from an internal queue.</span>

<span class="sd">        This method sets up a PUB socket for sending iopub messages, processes queued tasks (either callables or tuples with runnables),</span>
<span class="sd">        and handles coroutine execution. It waits for new tasks when the queue is empty and ensures proper cleanup and exception</span>
<span class="sd">        handling on shutdown.</span>

<span class="sd">        Args:</span>
<span class="sd">            tg: The task group used to manage concurrent tasks.</span>
<span class="sd">            task_status: Used to signal when the scheduler has started.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: Logs and handles exceptions raised during direct callable execution.</span>
<span class="sd">            PendingCancelled: Sets this exception on pending results in the queue upon shutdown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">asyncio_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="n">Backend</span><span class="o">.</span><span class="n">asyncio</span>
        <span class="k">if</span> <span class="n">asyncio_backend</span><span class="p">:</span>
            <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
            <span class="n">coro</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">coro</span><span class="p">,</span> <span class="n">eager_start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># pyright: ignore[reportCallIssue]</span>
                <span class="n">kwgs</span><span class="p">[</span><span class="s2">&quot;eager_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">coro</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Pending</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                            <span class="k">await</span> <span class="n">result</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Direct call failed&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">asyncio_backend</span><span class="p">:</span>
                        <span class="n">task</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_call_scheduled</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="n">context</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwgs</span><span class="p">)</span>  <span class="c1"># pyright: ignore[reportPossiblyUnboundVariable]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                            <span class="n">task</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">discard</span><span class="p">)</span>
                        <span class="k">del</span> <span class="n">task</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tg</span><span class="o">.</span><span class="n">start_soon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_scheduled</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">item</span><span class="p">,</span> <span class="n">result</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">asyncio_backend</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">:</span>
                    <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="n">tg</span><span class="o">.</span><span class="n">cancel_scope</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_call_scheduled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="p">:</span> <span class="n">Pending</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronously executes the function associated with the given instance, handling cancellation, delays, and exceptions.</span>

<span class="sd">        Args:</span>
<span class="sd">            pen: The [async_kernel.Pending][] object containing metadata about the function to execute, its arguments, and execution state.</span>

<span class="sd">        Workflow:</span>
<span class="sd">            - Sets the current instance in a context variable.</span>
<span class="sd">            - If the instance is cancelled before starting, sets a `PendingCancelled` error.</span>
<span class="sd">            - Otherwise, enters a cancellation scope:</span>
<span class="sd">                - Registers a canceller for the instance.</span>
<span class="sd">                - Waits for a specified delay if present in metadata.</span>
<span class="sd">                - Calls the function (sync or async) with provided arguments.</span>
<span class="sd">                - Sets the result or exception on the instance as appropriate.</span>
<span class="sd">            - Handles cancellation and other exceptions, logging errors as needed.</span>
<span class="sd">            - Resets the context variable after execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">token_pending</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pending_var</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
        <span class="n">token_ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_caller_token</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pen</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                    <span class="n">pen</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">PendingCancelled</span><span class="p">(</span><span class="s2">&quot;Cancelled before started.&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">()</span> <span class="k">as</span> <span class="n">scope</span><span class="p">:</span>
                    <span class="n">pen</span><span class="o">.</span><span class="n">set_canceller</span><span class="p">(</span><span class="k">lambda</span> <span class="n">msg</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_direct</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">cancel</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
                    <span class="c1"># Call later.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">delay</span> <span class="o">:=</span> <span class="n">md</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">((</span><span class="n">delay</span> <span class="o">:=</span> <span class="n">delay</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">+</span> <span class="n">md</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="k">await</span> <span class="n">anyio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                    <span class="c1"># Call now.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">md</span><span class="p">[</span><span class="s2">&quot;func&quot;</span><span class="p">](</span><span class="o">*</span><span class="n">md</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">md</span><span class="p">[</span><span class="s2">&quot;kwargs&quot;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">result</span>
                        <span class="n">pen</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="c1"># Cancelled.</span>
                    <span class="k">except</span> <span class="n">anyio</span><span class="o">.</span><span class="n">get_cancelled_exc_class</span><span class="p">()</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                            <span class="n">pen</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                        <span class="n">pen</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="c1"># Catch exceptions.</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">pen</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">set_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pending_var</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token_pending</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_caller_token</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">token_ident</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_start_idle_worker_cleanup_thead</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;A single thread to shutdown idle workers that have not been used for an extended duration.&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">IDLE_WORKER_SHUTDOWN_DURATION</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;_thread_cleanup_idle_workers&quot;</span><span class="p">):</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_cleanup_workers</span><span class="p">():</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">mark_thread_pydev_do_not_trace</span><span class="p">()</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">cutoff</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">IDLE_WORKER_SHUTDOWN_DURATION</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="k">for</span> <span class="n">worker</span> <span class="ow">in</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">caller</span><span class="o">.</span><span class="n">_worker_pool</span><span class="p">):</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">worker</span><span class="o">.</span><span class="n">_idle_time</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">):</span>
                                <span class="n">caller</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">worker</span><span class="p">)</span>
                                <span class="n">worker</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
                    <span class="n">_cleanup_workers</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_thread_cleanup_idle_workers</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">_thread_cleanup_idle_workers</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_cleanup_workers</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_thread_cleanup_idle_workers</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">id_current</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="s2">&quot;The id that is used for a caller for the current thread in CPython or context in Pyodide.&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;emscripten&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_caller_token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_existing</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">caller_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A [classmethod][] to get the caller instance from the corresponding thread if it exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            caller_id: The id of the caller which in CPython is also the the id of the thread in which it is running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_current</span><span class="p">()</span> <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">caller_id</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">caller_id</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_pending</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A [classmethod][] that returns the current result when called from inside a function scheduled by Caller.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_pending_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">all_callers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">running_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Caller</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A [classmethod][] to get a list of the callers.</span>

<span class="sd">        Args:</span>
<span class="sd">            running_only: Restrict the list to callers that are active (running in an async context).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">caller</span> <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="n">Caller</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">running</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">running_only</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">CallerCreateOptions</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves an existing child caller by name and backend, or creates a new one if not found.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Options for creating or retrieving a caller instance.</span>
<span class="sd">                - name: The name of the child caller to retrieve.</span>
<span class="sd">                - backend: The backend to match or assign to the caller.</span>
<span class="sd">                - backend_options: Options for the backend.</span>
<span class="sd">                - zmq_context: ZeroMQ context to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self: The retrieved or newly created caller instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If a caller with the specified name exists but the backend does not match.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The returned caller is added to `children` and stopped with this instance.</span>
<span class="sd">            - If &#39;backend&#39; and &#39;zmq_context&#39; are not specified they are copied from this instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">backend</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">caller</span><span class="o">.</span><span class="n">backend</span> <span class="o">!=</span> <span class="n">backend</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Backend mismatch! </span><span class="si">{</span><span class="n">backend</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="si">=}</span><span class="s2">&quot;</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">loop</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">caller</span><span class="o">.</span><span class="n">loop</span> <span class="o">!=</span> <span class="n">loop</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Event loop mismatch! </span><span class="si">{</span><span class="n">loop</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">loop</span><span class="si">=}</span><span class="s2">&quot;</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">caller</span>
            <span class="k">if</span> <span class="s2">&quot;backend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_options</span>
            <span class="k">if</span> <span class="s2">&quot;zmq_context&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;zmq_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span>
            <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s2">&quot;NewThread&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">_parent_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">caller</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">schedule_call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="n">T</span><span class="p">],</span>
        <span class="n">args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
        <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trackers</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">PendingTracker</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">PendingTracker</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">PendingTracker</span><span class="p">,</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">**</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule `func` to be called inside a task running in the callers thread (thread-safe).</span>

<span class="sd">        The methods [call_soon][Caller.call_soon] and [call_later][Caller.call_later]</span>
<span class="sd">        use this method in the background,  they should be used in preference to this method since they provide type hinting for the arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function to be called. If it returns a coroutine, it will be awaited and its result will be returned.</span>
<span class="sd">            args: Arguments corresponding to in the call to  `func`.</span>
<span class="sd">            kwargs: Keyword arguments to use with in the call to `func`.</span>
<span class="sd">            context: The context to use, if not provided the current context is used.</span>
<span class="sd">            trackers: The tracker subclasses of active trackers which to add the pending.</span>
<span class="sd">            **metadata: Additional metadata to store in the instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">in</span> <span class="p">{</span><span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span><span class="p">,</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span><span class="p">}:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">pen</span> <span class="o">=</span> <span class="n">Pending</span><span class="p">(</span><span class="n">trackers</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pen</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call_later</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule func to be called in caller&#39;s event loop copying the current context.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function.</span>
<span class="sd">            delay: The minimum delay to add between submission and execution.</span>
<span class="sd">            *args: Arguments to use with func.</span>
<span class="sd">            **kwargs: Keyword arguments to use with func.</span>

<span class="sd">        Info:</span>
<span class="sd">            All call arguments are packed into the instance&#39;s metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call_soon</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule func to be called in caller&#39;s event loop copying the current context.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function.</span>
<span class="sd">            *args: Arguments to use with func.</span>
<span class="sd">            **kwargs: Keyword arguments to use with func.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">call_direct</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schedule `func` to be called in caller&#39;s event loop directly.</span>

<span class="sd">        This method is provided to facilitate lightweight *thread-safe* function calls that</span>
<span class="sd">        need to be performed from within the callers event loop/taskgroup.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function.</span>
<span class="sd">            *args: Arguments to use with func.</span>
<span class="sd">            **kwargs: Keyword arguments to use with func.</span>

<span class="sd">        Warning:</span>

<span class="sd">            **Use this method for lightweight calls only!**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_thread</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call func in a worker thread using the same backend as the current instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function.</span>
<span class="sd">            *args: Arguments to use with func.</span>
<span class="sd">            **kwargs: Keyword arguments to use with func.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - A minimum number of caller instances are retained for this method.</span>
<span class="sd">            - Async code run inside func should use taskgroups for creating task.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_to_thread_on_done</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">caller</span><span class="o">.</span><span class="n">stopped</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_IDLE_POOL_INSTANCES</span><span class="p">:</span>
                    <span class="n">caller</span><span class="o">.</span><span class="n">_idle_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_idle_worker_cleanup_thead</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">caller</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">pen</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">pen</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">_to_thread_on_done</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pen</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">queue_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns `Pending` instance for `func` where the queue is running.</span>

<span class="sd">        Warning:</span>
<span class="sd">            - This instance loops until the instance is closed or func is garbage collected.</span>
<span class="sd">            - The pending has been modified such that waiting it will wait for the queue to be empty.</span>
<span class="sd">            - `queue_close` is the preferred means to shutdown the queue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">queue_call</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
        <span class="o">/</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Queue the execution of `func` in a queue unique to it and the caller instance (thread-safe).</span>

<span class="sd">        The returned pending is &#39;resettable&#39; and will provide the result of the most recent successful</span>
<span class="sd">        call once the queue has been emptied. Exceptions are not set, instead the result would be `None`.</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The function.</span>
<span class="sd">            *args: Arguments to use with `func`.</span>
<span class="sd">            **kwargs: Keyword arguments to use with `func`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pending: The pending where the queue loop is running.</span>

<span class="sd">        Warning:</span>
<span class="sd">            - Do not assume the result corresponds to the function call.</span>
<span class="sd">            - The returned pending returns the last result of the queue call once the queue becomes empty.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The queue runs in a *task* wrapped with a [async_kernel.pending.Pending][] that remains running until one of the following occurs:</span>
<span class="sd">                1. The pending is cancelled.</span>
<span class="sd">                2. The method [Caller.queue_close][] is called with `func` or `func`&#39;s hash.</span>
<span class="sd">                3. `func` is deleted (utilising [weakref.finalize][]).</span>
<span class="sd">            - The [context][contextvars.Context] of the initial call is used for subsequent queue calls.</span>
<span class="sd">            - Exceptions are &#39;swallowed&#39;; the last successful result is set on the pending.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pen_</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span>
            <span class="n">queue</span> <span class="o">=</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]](</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
                <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__self__</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_close</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

            <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">queue_loop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_pending</span><span class="p">()</span>
                <span class="k">assert</span> <span class="n">pen</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="n">result</span><span class="p">):</span>
                                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">result</span>
                        <span class="k">except</span> <span class="p">(</span><span class="n">anyio</span><span class="o">.</span><span class="n">get_cancelled_exc_class</span><span class="p">(),</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                                <span class="k">raise</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Execution </span><span class="si">%s</span><span class="s2"> failed&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
                            <span class="n">pen</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">item</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># noqa: PLW2901</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pen_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">queue_loop</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{},</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">)</span>
        <span class="n">pen_</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;queue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pen_</span><span class="o">.</span><span class="n">add_to_trackers</span><span class="p">()</span>  <span class="c1"># pyright: ignore[reportReturnType]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">queue_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the execution queue associated with `func` (thread-safe).</span>

<span class="sd">        Args:</span>
<span class="sd">            func: The queue of the function to close.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">func</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pen</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;queue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="s2">&quot;Yield to the event loop.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_safe_checkpoint</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="n">Backend</span><span class="o">.</span><span class="n">trio</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">trio_checkpoint</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">asyncio_checkpoint</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_use_safe_checkpoint</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">await</span> <span class="n">async_checkpoint</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">as_completed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">|</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_concurrent</span><span class="p">:</span> <span class="n">NoValue</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NoValue</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportInvalidTypeForm]</span>
        <span class="n">cancel_unfinished</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An iterator to get result as they complete.</span>

<span class="sd">        Args:</span>
<span class="sd">            items: Either a container with existing results or generator of Pendings.</span>
<span class="sd">            max_concurrent: The maximum number of concurrent results to monitor at a time.</span>
<span class="sd">                This is useful when `items` is a generator utilising [Caller.to_thread][].</span>
<span class="sd">                By default this will limit to `Caller.MAX_IDLE_POOL_INSTANCES`.</span>
<span class="sd">            cancel_unfinished: Cancel any `pending` when exiting.</span>

<span class="sd">        Tip:</span>
<span class="sd">            1. Pass a generator if you wish to limit the number result jobs when calling to_thread/to_task etc.</span>
<span class="sd">            2. Pass a container with all results when the limiter is not relevant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resume</span> <span class="o">=</span> <span class="n">noop</span>
        <span class="n">queue</span><span class="p">:</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
        <span class="n">unfinished</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">pen_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_pending</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">set</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">max_concurrent_</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_concurrent_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_IDLE_POOL_INSTANCES</span> <span class="k">if</span> <span class="n">max_concurrent</span> <span class="ow">is</span> <span class="n">NoValue</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_concurrent</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scheduler</span><span class="p">():</span>
            <span class="k">nonlocal</span> <span class="n">resume</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">AsyncGenerator</span><span class="p">)</span> <span class="k">else</span> <span class="nb">iter</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="n">is_async</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">AsyncGenerator</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">stopped</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pen</span> <span class="o">:=</span> <span class="k">await</span> <span class="n">anext</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_async</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="n">pen_current</span><span class="p">:</span>
                    <span class="n">queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Waiting for the pending in which it is running would result in deadlock!&quot;</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">Pending</span><span class="p">):</span>
                    <span class="n">pen</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Pending[T]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">await_for</span><span class="p">,</span> <span class="n">pen</span><span class="p">))</span>
                <span class="n">pen</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pen</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                    <span class="n">unfinished</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">max_concurrent_</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                        <span class="n">waiter</span> <span class="o">=</span> <span class="n">create_async_waiter</span><span class="p">()</span>
                        <span class="n">resume</span> <span class="o">=</span> <span class="n">waiter</span><span class="o">.</span><span class="n">wake</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                            <span class="k">await</span> <span class="n">waiter</span>
                        <span class="n">resume</span> <span class="o">=</span> <span class="n">noop</span>

        <span class="n">pen_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">scheduler</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
                <span class="n">unfinished</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">pen</span>
                <span class="k">if</span> <span class="n">pen_</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unfinished</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">max_concurrent_</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                        <span class="n">resume</span><span class="p">()</span>
            <span class="n">pen_</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="n">pen_</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">unfinished</span><span class="p">:</span>
                <span class="n">pen</span><span class="o">.</span><span class="n">remove_done_callback</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cancel_unfinished</span><span class="p">:</span>
                    <span class="n">pen</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s2">&quot;Cancelled by as_completed&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">():</span>
                <span class="k">await</span> <span class="n">pen_</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">return_when</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">,</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for the results given by items to complete.</span>

<span class="sd">        Returns two sets of the results: (done, pending).</span>

<span class="sd">        Args:</span>
<span class="sd">            items: An iterable of results to wait for.</span>
<span class="sd">            timeout: The maximum time before returning.</span>
<span class="sd">            return_when: The same options as available for [asyncio.wait][].</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            done, pending = await asyncio.wait(items)</span>
<span class="sd">            ```</span>
<span class="sd">        Info:</span>
<span class="sd">            - This does not raise a TimeoutError!</span>
<span class="sd">            - Pendings that aren&#39;t done when the timeout occurs are returned in the second set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pending</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Pending</span><span class="p">):</span>
                <span class="n">done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">else</span> <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">await_for</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>
            <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
                        <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>
        <span class="k">if</span> <span class="n">pending</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">move_on_after</span><span class="p">(</span><span class="n">timeout</span><span class="p">):</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">pending</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">cancel_unfinished</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="n">pending</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                    <span class="n">done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">()):</span>
                        <span class="k">break</span>
        <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_pending_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">shield</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new [PendingGroup][async_kernel.pending.PendingGroup] instance.</span>

<span class="sd">        The pending group will wait for all pending created in its context to complete (except for those that opt out).</span>
<span class="sd">        If any pending result in exception, the pending group and all registered pending are cancelled.</span>
<span class="sd">        If the pending group context is cancelled or results in exception, all pending in the group are</span>
<span class="sd">        also cancelled.</span>

<span class="sd">        Args:</span>
<span class="sd">            shield: Shield the pending group from external cancellation.</span>

<span class="sd">        Usage:</span>

<span class="sd">            ```python</span>
<span class="sd">            async with Caller().create_pending_group() as pg:</span>
<span class="sd">                pg.caller.to_thread(my_func)</span>
<span class="sd">                ...</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PendingGroup</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="n">shield</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">MAX_IDLE_POOL_INSTANCES</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.MAX_IDLE_POOL_INSTANCES" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">MAX_IDLE_POOL_INSTANCES</span> <span class="o">=</span> <span class="mi">10</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The number of <code>pool</code> instances to leave idle (See also <a class="autorefs autorefs-internal" title=" to_thread" href="#async_kernel.caller.Caller.to_thread">to_thread</a>).</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">IDLE_WORKER_SHUTDOWN_DURATION</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.IDLE_WORKER_SHUTDOWN_DURATION" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">IDLE_WORKER_SHUTDOWN_DURATION</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pytest&#39;</span> <span class="ow">in</span> <span class="n"><a class="autorefs autorefs-external" title="sys.modules" href="https://docs.python.org/3/library/sys.html#sys.modules">modules</a></span> <span class="k">else</span> <span class="mi">60</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The minimum duration in seconds for a worker to remain in the worker pool before it is shutdown.</p>
<p>Set to 0 to disable (default when running tests).</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.stopped" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">stopped</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.stopped" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">stopped</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title=" Fixed (async_kernel.common.Fixed)" href="../common/#async_kernel.common.Fixed">Fixed</a></span><span class="p">(</span><span class="n"><a class="autorefs autorefs-external" title="aiologic.Event" href="http://aiologic.readthedocs.io/latest/api.html#aiologic.Event">Event</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A thread-safe Event for when the caller is stopped.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.log" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">log</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.log" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">log</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="logging.LoggerAdapter" href="https://docs.python.org/3/library/logging.html#logging.LoggerAdapter">LoggerAdapter</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.iopub_sockets" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">iopub_sockets</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.iopub_sockets" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">iopub_sockets</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">,</span> <span class="n"><span title="zmq.Socket">Socket</span></span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>

    <div class="doc doc-contents ">

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.iopub_url" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">iopub_url</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#async_kernel.caller.Caller.iopub_url" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">iopub_url</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.ClassVar" href="https://docs.python.org/3/library/typing.html#typing.ClassVar">ClassVar</a></span> <span class="o">=</span> <span class="s1">&#39;inproc://iopub&#39;</span>
</code></pre></div>

    <div class="doc doc-contents ">

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.name" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">name</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The name of the thread when the caller was created.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.id" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.id" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nb">id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The id for the caller.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.backend" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">backend</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.backend" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">backend</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title=" Backend (async_kernel.typing.Backend)" href="../typing/#async_kernel.typing.Backend">Backend</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The backend used by caller.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.backend_options" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">backend_options</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.backend_options" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">backend_options</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Options used to create the backend.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.loop" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">loop</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.loop" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">loop</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title=" Loop (async_kernel.typing.Loop)" href="../typing/#async_kernel.typing.Loop">Loop</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The gui event loop if there is one.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.loop_options" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">loop_options</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.loop_options" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">loop_options</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Options used to create the gui event loop.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.protected" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">protected</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.protected" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">protected</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns <code>True</code> if the caller is protected from stopping.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.zmq_context" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">zmq_context</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.zmq_context" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">zmq_context</span><span class="p">:</span> <span class="n"><span title="zmq.Context">Context</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A zmq socket, which if present indicates that an iopub socket is loaded.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.running" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">running</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.running" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">running</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns <code>True</code> when the caller is available to run requests.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.children" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">children</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.children" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">children</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#frozenset">frozenset</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A frozenset copy of the instances that were created by the caller.</p>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>When the parent is stopped, all children are stopped.</li>
<li>All children are stopped prior to the parent exiting its async context.</li>
</ul>
</details>
          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.thread" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">thread</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.thread" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">thread</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="threading.Thread" href="https://docs.python.org/3/library/threading.html#threading.Thread">Thread</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The thread where the caller is running.</p>

          
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="async_kernel.caller.Caller.parent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">parent</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#async_kernel.caller.Caller.parent" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parent</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The parent caller if it exists.</p>

          
    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.__new__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__new__</span>


<a href="#async_kernel.caller.Caller.__new__" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__new__</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.__new__(modifier)">modifier</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span>
        <span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span> <span class="s2">&quot;MainThread&quot;</span><span class="p">,</span> <span class="s2">&quot;NewThread&quot;</span><span class="p">,</span> <span class="s2">&quot;manual&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.__new__(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Unpack" href="https://docs.python.org/3/library/typing.html#typing.Unpack">Unpack</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" CallerCreateOptions (async_kernel.typing.CallerCreateOptions)" href="../typing/#async_kernel.typing.CallerCreateOptions">CallerCreateOptions</a></span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create or retrieve a Caller instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.__new__(modifier)" class="doc doc-heading doc-heading-parameter">              <b><code>modifier</code></b>
<a href="#async_kernel.caller.Caller.__new__(modifier)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a>[&#39;CurrentThread&#39;, &#39;MainThread&#39;, &#39;NewThread&#39;, &#39;manual&#39;]</code>, default:
                  <code>&#39;CurrentThread&#39;</code>
)
          –
          <div class="doc-md-description">
            <p>Specifies how the Caller instance should be created or retrieved.</p>
<ul>
<li>"CurrentThread": Automatically create or retrieve the instance.</li>
<li>"MainThread": Use the main thread for the Caller.</li>
<li>"NewThread": Create a new thread.</li>
<li>"manual": Manually create a new instance for the current thread.</li>
</ul>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.__new__(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.__new__(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="typing.Unpack" href="https://docs.python.org/3/library/typing.html#typing.Unpack">Unpack</a>[<a class="autorefs autorefs-internal" title=" CallerCreateOptions (async_kernel.typing.CallerCreateOptions)" href="../typing/#async_kernel.typing.CallerCreateOptions">CallerCreateOptions</a>]</code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Additional options for Caller creation, such as:
- name: The name to use.
- backend: The async backend to use.
- backend_options: Options for the backend.
- protected: Whether the Caller is protected.
- zmq_context: ZeroMQ context.
- log: Logger instance.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></code>
)          –
          <div class="doc-md-description">
            <p>The created or retrieved Caller instance.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError">RuntimeError</a></code>
            –
          <div class="doc-md-description">
            <p>If the backend is not provided and backend can't be determined.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#ValueError">ValueError</a></code>
            –
          <div class="doc-md-description">
            <p>If the thread and caller's name do not match.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">modifier</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span> <span class="s2">&quot;MainThread&quot;</span><span class="p">,</span> <span class="s2">&quot;NewThread&quot;</span><span class="p">,</span> <span class="s2">&quot;manual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CurrentThread&quot;</span><span class="p">,</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">CallerCreateOptions</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create or retrieve a Caller instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        modifier: Specifies how the Caller instance should be created or retrieved.</span>

<span class="sd">            - &quot;CurrentThread&quot;: Automatically create or retrieve the instance.</span>
<span class="sd">            - &quot;MainThread&quot;: Use the main thread for the Caller.</span>
<span class="sd">            - &quot;NewThread&quot;: Create a new thread.</span>
<span class="sd">            - &quot;manual&quot;: Manually create a new instance for the current thread.</span>

<span class="sd">        **kwargs: Additional options for Caller creation, such as:</span>
<span class="sd">            - name: The name to use.</span>
<span class="sd">            - backend: The async backend to use.</span>
<span class="sd">            - backend_options: Options for the backend.</span>
<span class="sd">            - protected: Whether the Caller is protected.</span>
<span class="sd">            - zmq_context: ZeroMQ context.</span>
<span class="sd">            - log: Logger instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self: The created or retrieved Caller instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the backend is not provided and backend can&#39;t be determined.</span>
<span class="sd">        ValueError: If the thread and caller&#39;s name do not match.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">backend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">modifier</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;CurrentThread&quot;</span> <span class="o">|</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
                <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_current</span><span class="p">()</span>
            <span class="k">case</span> <span class="s2">&quot;MainThread&quot;</span><span class="p">:</span>
                <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">CALLER_MAIN_THREAD_ID</span>
            <span class="k">case</span> <span class="s2">&quot;NewThread&quot;</span><span class="p">:</span>
                <span class="n">caller_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Locate existing</span>
        <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">caller</span> <span class="o">:=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">caller_id</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">modifier</span> <span class="o">==</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;An instance already exists for </span><span class="si">{</span><span class="n">caller_id</span><span class="si">=}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The thread and caller&#39;s name do not match! </span><span class="si">{</span><span class="n">name</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="si">=}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">backend</span> <span class="ow">and</span> <span class="n">backend</span> <span class="o">!=</span> <span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The backend does not match! </span><span class="si">{</span><span class="n">backend</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="si">=}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">caller</span>

        <span class="c1"># create a new instance</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">Backend</span><span class="p">(</span><span class="n">backend</span> <span class="ow">or</span> <span class="n">current_async_library</span><span class="p">())</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">Loop</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">loop</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_backend_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend_options&quot;</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_loop_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop_options&quot;</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_protected</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;protected&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">_zmq_context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zmq_context&quot;</span><span class="p">)</span>
        <span class="n">inst</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">LoggerAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;emscripten&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">caller_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">caller_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span> <span class="o">=</span> <span class="n">caller_id</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>

        <span class="c1"># finalize</span>
        <span class="k">if</span> <span class="n">modifier</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span><span class="p">:</span>
            <span class="n">inst</span><span class="o">.</span><span class="n">start_sync</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span>
        <span class="k">assert</span> <span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="p">[</span><span class="n">inst</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst</span>
    <span class="k">return</span> <span class="n">inst</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.start_sync" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">start_sync</span>


<a href="#async_kernel.caller.Caller.start_sync" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">start_sync</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Start synchronously.</p>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#usage">Usage</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#caller">Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/#modifier">Modifier</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;Start synchronously.&quot;</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_caller_in_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span>
            <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span>

    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_caller_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># An event loop for the current thread.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="o">==</span> <span class="n">Backend</span><span class="o">.</span><span class="n">asyncio</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">run_caller_in_context</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># trio</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">current_token</span><span class="p">()</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">to_thread</span><span class="p">():</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">mark_thread_pydev_do_not_trace</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">anyio</span><span class="o">.</span><span class="n">from_thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_caller_in_context</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">BaseExceptionGroup</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;shutdown&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                        <span class="k">raise</span>

            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">to_thread</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;async_kernel_caller&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">RunSettings</span><span class="p">(</span>
            <span class="n">backend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
            <span class="n">loop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop</span><span class="p">,</span>
            <span class="n">backend_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend_options</span><span class="p">,</span>
            <span class="n">loop_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loop_options</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">run_caller_in_context</span><span class="p">,</span> <span class="p">(),</span> <span class="n">settings</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">async_kernel</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.stop" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">stop</span>


<a href="#async_kernel.caller.Caller.stop" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">stop</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n"><span title="async_kernel.caller.Caller.stop(force)">force</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" CallerState (async_kernel.typing.CallerState)" href="../typing/#async_kernel.typing.CallerState">CallerState</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Stop the caller cancelling all incomplete tasks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.stop(force)" class="doc doc-heading doc-heading-parameter">              <b><code>force</code></b>
<a href="#async_kernel.caller.Caller.stop(force)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>If the caller is protected the call is a no-op unless force=True.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallerState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stop the caller cancelling all incomplete tasks.</span>

<span class="sd">    Args:</span>
<span class="sd">        force: If the caller is protected the call is a no-op unless force=True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_protected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
    <span class="n">set_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">in</span> <span class="p">[</span><span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span><span class="p">,</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parent</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_close</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">set_stop</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.__asynccontextmanager__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">__asynccontextmanager__</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#async_kernel.caller.Caller.__asynccontextmanager__" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__asynccontextmanager__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.AsyncGenerator" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.AsyncGenerator">AsyncGenerator</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The asynchronous context for caller.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">__asynccontextmanager__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
    <span class="s2">&quot;The asynchronous context for caller.&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">initial</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">start_sync</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Already starting! Did you mean to use Caller(&quot;manual&quot;)?&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Caller cannot be been re-entered!&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">create_task_group</span><span class="p">()</span> <span class="k">as</span> <span class="n">tg</span><span class="p">:</span>
        <span class="n">socket</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">running</span>
        <span class="n">tg</span><span class="o">.</span><span class="n">start_soon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scheduler</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">,</span> <span class="n">tg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="p">:</span>
            <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># zmq.SocketType.PUB</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">linger</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iopub_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iopub_sockets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">socket</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">socket</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iopub_sockets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_caller_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">stopped</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stopped</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.id_current" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">id_current</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#async_kernel.caller.Caller.id_current" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">id_current</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The id that is used for a caller for the current thread in CPython or context in Pyodide.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">id_current</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s2">&quot;The id that is used for a caller for the current thread in CPython or context in Pyodide.&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;emscripten&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_caller_token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.get_existing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_existing</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#async_kernel.caller.Caller.get_existing" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_existing</span><span class="p">(</span><span class="n"><span title="async_kernel.caller.Caller.get_existing(caller_id)">caller_id</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> to get the caller instance from the corresponding thread if it exists.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.get_existing(caller_id)" class="doc doc-heading doc-heading-parameter">              <b><code>caller_id</code></b>
<a href="#async_kernel.caller.Caller.get_existing(caller_id)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The id of the caller which in CPython is also the the id of the thread in which it is running.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_existing</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">caller_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A [classmethod][] to get the caller instance from the corresponding thread if it exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        caller_id: The id of the caller which in CPython is also the the id of the thread in which it is running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">caller_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">id_current</span><span class="p">()</span> <span class="k">if</span> <span class="n">caller_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">caller_id</span>
    <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">caller_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.current_pending" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">current_pending</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#async_kernel.caller.Caller.current_pending" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">current_pending</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> that returns the current result when called from inside a function scheduled by Caller.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">current_pending</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A [classmethod][] that returns the current result when called from inside a function scheduled by Caller.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_pending_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.all_callers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">all_callers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#async_kernel.caller.Caller.all_callers" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">all_callers</span><span class="p">(</span><span class="n"><span title="async_kernel.caller.Caller.all_callers(running_only)">running_only</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" Caller (async_kernel.caller.Caller)" href="#async_kernel.caller.Caller">Caller</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>A <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#classmethod">classmethod</a> to get a list of the callers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.all_callers(running_only)" class="doc doc-heading doc-heading-parameter">              <b><code>running_only</code></b>
<a href="#async_kernel.caller.Caller.all_callers(running_only)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>Restrict the list to callers that are active (running in an async context).</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">all_callers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">running_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Caller</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A [classmethod][] to get a list of the callers.</span>

<span class="sd">    Args:</span>
<span class="sd">        running_only: Restrict the list to callers that are active (running in an async context).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">caller</span> <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="n">Caller</span><span class="o">.</span><span class="n">_instances</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">running</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">running_only</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.get" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get</span>


<a href="#async_kernel.caller.Caller.get" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get</span><span class="p">(</span><span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.get(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Unpack" href="https://docs.python.org/3/library/typing.html#typing.Unpack">Unpack</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" CallerCreateOptions (async_kernel.typing.CallerCreateOptions)" href="../typing/#async_kernel.typing.CallerCreateOptions">CallerCreateOptions</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieves an existing child caller by name and backend, or creates a new one if not found.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.get(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.get(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="typing.Unpack" href="https://docs.python.org/3/library/typing.html#typing.Unpack">Unpack</a>[<a class="autorefs autorefs-internal" title=" CallerCreateOptions (async_kernel.typing.CallerCreateOptions)" href="../typing/#async_kernel.typing.CallerCreateOptions">CallerCreateOptions</a>]</code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Options for creating or retrieving a caller instance.
- name: The name of the child caller to retrieve.
- backend: The backend to match or assign to the caller.
- backend_options: Options for the backend.
- zmq_context: ZeroMQ context to use.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Self</code></b> (              <code><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></code>
)          –
          <div class="doc-md-description">
            <p>The retrieved or newly created caller instance.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Raises:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError">RuntimeError</a></code>
            –
          <div class="doc-md-description">
            <p>If a caller with the specified name exists but the backend does not match.</p>
          </div>
        </li>
    </ul>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The returned caller is added to <code>children</code> and stopped with this instance.</li>
<li>If 'backend' and 'zmq_context' are not specified they are copied from this instance.</li>
</ul>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#usage">Usage</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#caller">Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/#callerget">Caller.get</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">CallerCreateOptions</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves an existing child caller by name and backend, or creates a new one if not found.</span>

<span class="sd">    Args:</span>
<span class="sd">        **kwargs: Options for creating or retrieving a caller instance.</span>
<span class="sd">            - name: The name of the child caller to retrieve.</span>
<span class="sd">            - backend: The backend to match or assign to the caller.</span>
<span class="sd">            - backend_options: Options for the backend.</span>
<span class="sd">            - zmq_context: ZeroMQ context to use.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self: The retrieved or newly created caller instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If a caller with the specified name exists but the backend does not match.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The returned caller is added to `children` and stopped with this instance.</span>
<span class="sd">        - If &#39;backend&#39; and &#39;zmq_context&#39; are not specified they are copied from this instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_child_lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">caller</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">backend</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">caller</span><span class="o">.</span><span class="n">backend</span> <span class="o">!=</span> <span class="n">backend</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Backend mismatch! </span><span class="si">{</span><span class="n">backend</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">backend</span><span class="si">=}</span><span class="s2">&quot;</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">loop</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loop&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">caller</span><span class="o">.</span><span class="n">loop</span> <span class="o">!=</span> <span class="n">loop</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Event loop mismatch! </span><span class="si">{</span><span class="n">loop</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">loop</span><span class="si">=}</span><span class="s2">&quot;</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">caller</span>
        <span class="k">if</span> <span class="s2">&quot;backend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;backend_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_options</span>
        <span class="k">if</span> <span class="s2">&quot;zmq_context&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;zmq_context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zmq_context</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s2">&quot;NewThread&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">_parent_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">caller</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.schedule_call" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">schedule_call</span>


<a href="#async_kernel.caller.Caller.schedule_call" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schedule_call</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.schedule_call(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span> <span class="o">|</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">],</span>
    <span class="n"><span title="async_kernel.caller.Caller.schedule_call(args)">args</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.schedule_call(kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.schedule_call(context)">context</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="contextvars.Context" href="https://docs.python.org/3/library/contextvars.html#contextvars.Context">Context</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.schedule_call(trackers)">trackers</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a></span><span class="p">]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a></span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a></span><span class="p">,</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.schedule_call(**metadata)">metadata</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Schedule <code>func</code> to be called inside a task running in the callers thread (thread-safe).</p>
<p>The methods <a class="autorefs autorefs-internal" title=" call_soon" href="#async_kernel.caller.Caller.call_soon">call_soon</a> and <a class="autorefs autorefs-internal" title=" call_later" href="#async_kernel.caller.Caller.call_later">call_later</a>
use this method in the background,  they should be used in preference to this method since they provide type hinting for the arguments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[..., <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>] | <span title="async_kernel.typing.T">T</span>]</code>)
          –
          <div class="doc-md-description">
            <p>The function to be called. If it returns a coroutine, it will be awaited and its result will be returned.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(args)" class="doc doc-heading doc-heading-parameter">              <b><code>args</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></code>)
          –
          <div class="doc-md-description">
            <p>Arguments corresponding to in the call to  <code>func</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>kwargs</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a></code>)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with in the call to <code>func</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(context)" class="doc doc-heading doc-heading-parameter">              <b><code>context</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(context)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="contextvars.Context" href="https://docs.python.org/3/library/contextvars.html#contextvars.Context">Context</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The context to use, if not provided the current context is used.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(trackers)" class="doc doc-heading doc-heading-parameter">              <b><code>trackers</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(trackers)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a>] | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#type">type</a>[<a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a>], ...]</code>, default:
                  <code><a class="autorefs autorefs-internal" title=" PendingTracker (async_kernel.pending.PendingTracker)" href="../pending/#async_kernel.pending.PendingTracker">PendingTracker</a></code>
)
          –
          <div class="doc-md-description">
            <p>The tracker subclasses of active trackers which to add the pending.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.schedule_call(**metadata)" class="doc doc-heading doc-heading-parameter">              <b><code>**metadata</code></b>
<a href="#async_kernel.caller.Caller.schedule_call(**metadata)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Additional metadata to store in the instance.</p>
          </div>
        </li>
    </ul>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">schedule_call</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="n">T</span><span class="p">],</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
    <span class="n">kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">Context</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trackers</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">PendingTracker</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">PendingTracker</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">PendingTracker</span><span class="p">,</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">**</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schedule `func` to be called inside a task running in the callers thread (thread-safe).</span>

<span class="sd">    The methods [call_soon][Caller.call_soon] and [call_later][Caller.call_later]</span>
<span class="sd">    use this method in the background,  they should be used in preference to this method since they provide type hinting for the arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function to be called. If it returns a coroutine, it will be awaited and its result will be returned.</span>
<span class="sd">        args: Arguments corresponding to in the call to  `func`.</span>
<span class="sd">        kwargs: Keyword arguments to use with in the call to `func`.</span>
<span class="sd">        context: The context to use, if not provided the current context is used.</span>
<span class="sd">        trackers: The tracker subclasses of active trackers which to add the pending.</span>
<span class="sd">        **metadata: Additional metadata to store in the instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="ow">in</span> <span class="p">{</span><span class="n">CallerState</span><span class="o">.</span><span class="n">stopping</span><span class="p">,</span> <span class="n">CallerState</span><span class="o">.</span><span class="n">stopped</span><span class="p">}:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">Pending</span><span class="p">(</span><span class="n">trackers</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pen</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.call_later" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">call_later</span>


<a href="#async_kernel.caller.Caller.call_later" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">call_later</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.call_later(delay)">delay</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.call_later(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.P">P</span></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n"><span title="async_kernel.caller.Caller.call_later(*args)">args</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.args">args</span></span><span class="p">,</span>
    <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.call_later(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.kwargs">kwargs</span></span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Schedule func to be called in caller's event loop copying the current context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_later(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.call_later(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[<span title="async_kernel.typing.P">P</span>, <span title="async_kernel.typing.T">T</span> | <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>The function.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_later(delay)" class="doc doc-heading doc-heading-parameter">              <b><code>delay</code></b>
<a href="#async_kernel.caller.Caller.call_later(delay)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          –
          <div class="doc-md-description">
            <p>The minimum delay to add between submission and execution.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_later(*args)" class="doc doc-heading doc-heading-parameter">              <b><code>*args</code></b>
<a href="#async_kernel.caller.Caller.call_later(*args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.args">args</span></code>, default:
                  <code>()</code>
)
          –
          <div class="doc-md-description">
            <p>Arguments to use with func.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_later(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.call_later(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.kwargs">kwargs</span></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with func.</p>
          </div>
        </li>
    </ul>


<details class="info" open>
  <summary>Info</summary>
  <p>All call arguments are packed into the instance's metadata.</p>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller.schedule_call"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;schedule_call</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">call_later</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">delay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schedule func to be called in caller&#39;s event loop copying the current context.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function.</span>
<span class="sd">        delay: The minimum delay to add between submission and execution.</span>
<span class="sd">        *args: Arguments to use with func.</span>
<span class="sd">        **kwargs: Keyword arguments to use with func.</span>

<span class="sd">    Info:</span>
<span class="sd">        All call arguments are packed into the instance&#39;s metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.call_soon" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">call_soon</span>


<a href="#async_kernel.caller.Caller.call_soon" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">call_soon</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.call_soon(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.P">P</span></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n"><span title="async_kernel.caller.Caller.call_soon(*args)">args</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.args">args</span></span><span class="p">,</span> <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.call_soon(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.kwargs">kwargs</span></span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Schedule func to be called in caller's event loop copying the current context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_soon(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.call_soon(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[<span title="async_kernel.typing.P">P</span>, <span title="async_kernel.typing.T">T</span> | <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>The function.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_soon(*args)" class="doc doc-heading doc-heading-parameter">              <b><code>*args</code></b>
<a href="#async_kernel.caller.Caller.call_soon(*args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.args">args</span></code>, default:
                  <code>()</code>
)
          –
          <div class="doc-md-description">
            <p>Arguments to use with func.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_soon(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.call_soon(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.kwargs">kwargs</span></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with func.</p>
          </div>
        </li>
    </ul>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller.schedule_call"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;schedule_call</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../typing/#">typing</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.RunMode"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunMode</a>
  </span>

      </li>
  </ul>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/message_handling/#message-handling">Message handling</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/message_handling/#run-mode">Run mode</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">call_soon</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schedule func to be called in caller&#39;s event loop copying the current context.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function.</span>
<span class="sd">        *args: Arguments to use with func.</span>
<span class="sd">        **kwargs: Keyword arguments to use with func.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.call_direct" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">call_direct</span>


<a href="#async_kernel.caller.Caller.call_direct" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">call_direct</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.call_direct(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.P">P</span></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n"><span title="async_kernel.caller.Caller.call_direct(*args)">args</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.args">args</span></span><span class="p">,</span> <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.call_direct(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.kwargs">kwargs</span></span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Schedule <code>func</code> to be called in caller's event loop directly.</p>
<p>This method is provided to facilitate lightweight <em>thread-safe</em> function calls that
need to be performed from within the callers event loop/taskgroup.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_direct(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.call_direct(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[<span title="async_kernel.typing.P">P</span>, <span title="async_kernel.typing.T">T</span> | <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>The function.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_direct(*args)" class="doc doc-heading doc-heading-parameter">              <b><code>*args</code></b>
<a href="#async_kernel.caller.Caller.call_direct(*args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.args">args</span></code>, default:
                  <code>()</code>
)
          –
          <div class="doc-md-description">
            <p>Arguments to use with func.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.call_direct(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.call_direct(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.kwargs">kwargs</span></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with func.</p>
          </div>
        </li>
    </ul>
        <p>Warning:</p>
<pre><code>**Use this method for lightweight calls only!**
</code></pre>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/message_handling/#message-handling">Message handling</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/message_handling/#run-mode">Run mode</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../typing/#">typing</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.RunMode"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunMode</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">call_direct</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schedule `func` to be called in caller&#39;s event loop directly.</span>

<span class="sd">    This method is provided to facilitate lightweight *thread-safe* function calls that</span>
<span class="sd">    need to be performed from within the callers event loop/taskgroup.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function.</span>
<span class="sd">        *args: Arguments to use with func.</span>
<span class="sd">        **kwargs: Keyword arguments to use with func.</span>

<span class="sd">    Warning:</span>

<span class="sd">        **Use this method for lightweight calls only!**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.to_thread" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_thread</span>


<a href="#async_kernel.caller.Caller.to_thread" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_thread</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.to_thread(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.P">P</span></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n"><span title="async_kernel.caller.Caller.to_thread(*args)">args</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.args">args</span></span><span class="p">,</span> <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.to_thread(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.kwargs">kwargs</span></span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call func in a worker thread using the same backend as the current instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.to_thread(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.to_thread(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[<span title="async_kernel.typing.P">P</span>, <span title="async_kernel.typing.T">T</span> | <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>The function.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.to_thread(*args)" class="doc doc-heading doc-heading-parameter">              <b><code>*args</code></b>
<a href="#async_kernel.caller.Caller.to_thread(*args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.args">args</span></code>, default:
                  <code>()</code>
)
          –
          <div class="doc-md-description">
            <p>Arguments to use with func.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.to_thread(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.to_thread(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.kwargs">kwargs</span></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with func.</p>
          </div>
        </li>
    </ul>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>A minimum number of caller instances are retained for this method.</li>
<li>Async code run inside func should use taskgroups for creating task.</li>
</ul>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../typing/#">typing</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.RunMode"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunMode</a>
  </span>

      </li>
  </ul>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../../usage/message_handling/#message-handling">Message handling</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/message_handling/#run-mode">Run mode</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#usage">Usage</a>
  </span>

            <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/#blocking-code">Blocking code</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <a href="../../usage/#caller">Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/#callerto_thread">Caller.to_thread</a>
  </span>

      </li>
  </ul>

      </li>
  </ul>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_thread</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call func in a worker thread using the same backend as the current instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function.</span>
<span class="sd">        *args: Arguments to use with func.</span>
<span class="sd">        **kwargs: Keyword arguments to use with func.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - A minimum number of caller instances are retained for this method.</span>
<span class="sd">        - Async code run inside func should use taskgroups for creating task.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_thread_on_done</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">caller</span><span class="o">.</span><span class="n">stopped</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_IDLE_POOL_INSTANCES</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">_idle_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_idle_worker_cleanup_thead</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_pool</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">pen</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">_to_thread_on_done</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pen</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.queue_get" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">queue_get</span>


<a href="#async_kernel.caller.Caller.queue_get" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">queue_get</span><span class="p">(</span><span class="n"><span title="async_kernel.caller.Caller.queue_get(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Returns <code>Pending</code> instance for <code>func</code> where the queue is running.</p>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>This instance loops until the instance is closed or func is garbage collected.</li>
<li>The pending has been modified such that waiting it will wait for the queue to be empty.</li>
<li><code>queue_close</code> is the preferred means to shutdown the queue.</li>
</ul>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">queue_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns `Pending` instance for `func` where the queue is running.</span>

<span class="sd">    Warning:</span>
<span class="sd">        - This instance loops until the instance is closed or func is garbage collected.</span>
<span class="sd">        - The pending has been modified such that waiting it will wait for the queue to be empty.</span>
<span class="sd">        - `queue_close` is the preferred means to shutdown the queue.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.queue_call" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">queue_call</span>


<a href="#async_kernel.caller.Caller.queue_call" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">queue_call</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.queue_call(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.P">P</span></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">,</span> <span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n"><span title="async_kernel.caller.Caller.queue_call(*args)">args</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.args">args</span></span><span class="p">,</span> <span class="o">**</span><span class="n"><span title="async_kernel.caller.Caller.queue_call(**kwargs)">kwargs</span></span><span class="p">:</span> <span class="n"><span title="async_kernel.typing.P.kwargs">kwargs</span></span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Queue the execution of <code>func</code> in a queue unique to it and the caller instance (thread-safe).</p>
<p>The returned pending is 'resettable' and will provide the result of the most recent successful
call once the queue has been emptied. Exceptions are not set, instead the result would be <code>None</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.queue_call(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.queue_call(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a>[<span title="async_kernel.typing.P">P</span>, <span title="async_kernel.typing.T">T</span> | <a class="autorefs autorefs-external" title="types.CoroutineType" href="https://docs.python.org/3/library/types.html#types.CoroutineType">CoroutineType</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>The function.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.queue_call(*args)" class="doc doc-heading doc-heading-parameter">              <b><code>*args</code></b>
<a href="#async_kernel.caller.Caller.queue_call(*args)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.args">args</span></code>, default:
                  <code>()</code>
)
          –
          <div class="doc-md-description">
            <p>Arguments to use with <code>func</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.queue_call(**kwargs)" class="doc doc-heading doc-heading-parameter">              <b><code>**kwargs</code></b>
<a href="#async_kernel.caller.Caller.queue_call(**kwargs)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><span title="async_kernel.typing.P.kwargs">kwargs</span></code>, default:
                  <code>{}</code>
)
          –
          <div class="doc-md-description">
            <p>Keyword arguments to use with <code>func</code>.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>Pending</code></b> (              <code><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a>[<span title="async_kernel.typing.T">T</span>]</code>
)          –
          <div class="doc-md-description">
            <p>The pending where the queue loop is running.</p>
          </div>
        </li>
    </ul>


<details class="warning" open>
  <summary>Warning</summary>
  <ul>
<li>Do not assume the result corresponds to the function call.</li>
<li>The returned pending returns the last result of the queue call once the queue becomes empty.</li>
</ul>
</details>

<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The queue runs in a <em>task</em> wrapped with a <a class="autorefs autorefs-internal" title=" Pending" href="../pending/#async_kernel.pending.Pending">async_kernel.pending.Pending</a> that remains running until one of the following occurs:<ol>
<li>The pending is cancelled.</li>
<li>The method <a class="autorefs autorefs-internal" title=" queue_close" href="#async_kernel.caller.Caller.queue_close">Caller.queue_close</a> is called with <code>func</code> or <code>func</code>'s hash.</li>
<li><code>func</code> is deleted (utilising <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/weakref.html#weakref.finalize">weakref.finalize</a>).</li>
</ol>
</li>
<li>The <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/contextvars.html#contextvars.Context">context</a> of the initial call is used for subsequent queue calls.</li>
<li>Exceptions are 'swallowed'; the last successful result is set on the pending.</li>
</ul>
</details>
          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Usage</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../../usage/message_handling/#message-handling">Message handling</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../../usage/message_handling/#run-mode">Run mode</a>
  </span>

      </li>
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="../typing/#">typing</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="../typing/#async_kernel.typing.RunMode"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RunMode</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">queue_call</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span> <span class="o">|</span> <span class="n">CoroutineType</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Queue the execution of `func` in a queue unique to it and the caller instance (thread-safe).</span>

<span class="sd">    The returned pending is &#39;resettable&#39; and will provide the result of the most recent successful</span>
<span class="sd">    call once the queue has been emptied. Exceptions are not set, instead the result would be `None`.</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The function.</span>
<span class="sd">        *args: Arguments to use with `func`.</span>
<span class="sd">        **kwargs: Keyword arguments to use with `func`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Pending: The pending where the queue loop is running.</span>

<span class="sd">    Warning:</span>
<span class="sd">        - Do not assume the result corresponds to the function call.</span>
<span class="sd">        - The returned pending returns the last result of the queue call once the queue becomes empty.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The queue runs in a *task* wrapped with a [async_kernel.pending.Pending][] that remains running until one of the following occurs:</span>
<span class="sd">            1. The pending is cancelled.</span>
<span class="sd">            2. The method [Caller.queue_close][] is called with `func` or `func`&#39;s hash.</span>
<span class="sd">            3. `func` is deleted (utilising [weakref.finalize][]).</span>
<span class="sd">        - The [context][contextvars.Context] of the initial call is used for subsequent queue calls.</span>
<span class="sd">        - Exceptions are &#39;swallowed&#39;; the last successful result is set on the pending.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pen_</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]](</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">weakref</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__self__</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_close</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">queue_loop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_pending</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">pen</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="nb">object</span><span class="o">=</span><span class="n">result</span><span class="p">):</span>
                            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">result</span>
                    <span class="k">except</span> <span class="p">(</span><span class="n">anyio</span><span class="o">.</span><span class="n">get_cancelled_exc_class</span><span class="p">(),</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">():</span>
                            <span class="k">raise</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Execution </span><span class="si">%s</span><span class="s2"> failed&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
                        <span class="n">pen</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># noqa: PLW2901</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pen_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule_call</span><span class="p">(</span><span class="n">queue_loop</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{},</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">)</span>
    <span class="n">pen_</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;queue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pen_</span><span class="o">.</span><span class="n">add_to_trackers</span><span class="p">()</span>  <span class="c1"># pyright: ignore[reportReturnType]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.queue_close" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">queue_close</span>


<a href="#async_kernel.caller.Caller.queue_close" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">queue_close</span><span class="p">(</span><span class="n"><span title="async_kernel.caller.Caller.queue_close(func)">func</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Close the execution queue associated with <code>func</code> (thread-safe).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.queue_close(func)" class="doc doc-heading doc-heading-parameter">              <b><code>func</code></b>
<a href="#async_kernel.caller.Caller.queue_close(func)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Callable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable">Callable</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          –
          <div class="doc-md-description">
            <p>The queue of the function to close.</p>
          </div>
        </li>
    </ul>

          


  <div class="doc doc-backlinks">
        <b class="doc doc-backlink-type">Referenced by:</b>
          <ul class="doc doc-backlink-list">
      <li class="doc doc-backlink">
            <span class="doc doc-backlink-crumb">
      <span>Reference</span>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#">caller</a>
  </span>

            <span class="doc doc-backlink-crumb">
      <a href="#async_kernel.caller.Caller"><code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Caller</a>
  </span>

            <span class="doc doc-backlink-crumb last">
      <a href="#async_kernel.caller.Caller.queue_call"><code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;queue_call</a>
  </span>

      </li>
  </ul>

  </div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">queue_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Close the execution queue associated with `func` (thread-safe).</span>

<span class="sd">    Args:</span>
<span class="sd">        func: The queue of the function to close.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">func</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="nb">hash</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pen</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue_map</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">pen</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;queue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">pen</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.checkpoint" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">checkpoint</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#async_kernel.caller.Caller.checkpoint" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">checkpoint</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Yield to the event loop.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;Yield to the event loop.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_safe_checkpoint</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="n">Backend</span><span class="o">.</span><span class="n">trio</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">trio_checkpoint</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">asyncio_checkpoint</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_safe_checkpoint</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
    <span class="k">await</span> <span class="n">async_checkpoint</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.as_completed" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">as_completed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#async_kernel.caller.Caller.as_completed" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">as_completed</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.as_completed(items)">items</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Iterable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable">Iterable</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]]</span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.AsyncGenerator" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.AsyncGenerator">AsyncGenerator</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.as_completed(max_concurrent)">max_concurrent</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title=" NoValue (async_kernel.typing.NoValue)" href="../typing/#async_kernel.typing.NoValue">NoValue</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title=" NoValue (async_kernel.typing.NoValue)" href="../typing/#async_kernel.typing.NoValue">NoValue</a></span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.as_completed(cancel_unfinished)">cancel_unfinished</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.AsyncGenerator" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.AsyncGenerator">AsyncGenerator</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>An iterator to get result as they complete.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.as_completed(items)" class="doc doc-heading doc-heading-parameter">              <b><code>items</code></b>
<a href="#async_kernel.caller.Caller.as_completed(items)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Iterable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable">Iterable</a>[<a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a>[<span title="async_kernel.typing.T">T</span>]] | <a class="autorefs autorefs-external" title="collections.abc.AsyncGenerator" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.AsyncGenerator">AsyncGenerator</a>[<a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a>[<span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>Either a container with existing results or generator of Pendings.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.as_completed(max_concurrent)" class="doc doc-heading doc-heading-parameter">              <b><code>max_concurrent</code></b>
<a href="#async_kernel.caller.Caller.as_completed(max_concurrent)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-internal" title=" NoValue (async_kernel.typing.NoValue)" href="../typing/#async_kernel.typing.NoValue">NoValue</a> | <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code><a class="autorefs autorefs-internal" title=" NoValue (async_kernel.typing.NoValue)" href="../typing/#async_kernel.typing.NoValue">NoValue</a></code>
)
          –
          <div class="doc-md-description">
            <p>The maximum number of concurrent results to monitor at a time.
This is useful when <code>items</code> is a generator utilising <a class="autorefs autorefs-internal" title=" to_thread" href="#async_kernel.caller.Caller.to_thread">Caller.to_thread</a>.
By default this will limit to <code>Caller.MAX_IDLE_POOL_INSTANCES</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.as_completed(cancel_unfinished)" class="doc doc-heading doc-heading-parameter">              <b><code>cancel_unfinished</code></b>
<a href="#async_kernel.caller.Caller.as_completed(cancel_unfinished)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          –
          <div class="doc-md-description">
            <p>Cancel any <code>pending</code> when exiting.</p>
          </div>
        </li>
    </ul>


<details class="tip" open>
  <summary>Tip</summary>
  <ol>
<li>Pass a generator if you wish to limit the number result jobs when calling to_thread/to_task etc.</li>
<li>Pass a container with all results when the limiter is not relevant.</li>
</ol>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">as_completed</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">|</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_concurrent</span><span class="p">:</span> <span class="n">NoValue</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">NoValue</span><span class="p">,</span>  <span class="c1"># pyright: ignore[reportInvalidTypeForm]</span>
    <span class="n">cancel_unfinished</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An iterator to get result as they complete.</span>

<span class="sd">    Args:</span>
<span class="sd">        items: Either a container with existing results or generator of Pendings.</span>
<span class="sd">        max_concurrent: The maximum number of concurrent results to monitor at a time.</span>
<span class="sd">            This is useful when `items` is a generator utilising [Caller.to_thread][].</span>
<span class="sd">            By default this will limit to `Caller.MAX_IDLE_POOL_INSTANCES`.</span>
<span class="sd">        cancel_unfinished: Cancel any `pending` when exiting.</span>

<span class="sd">    Tip:</span>
<span class="sd">        1. Pass a generator if you wish to limit the number result jobs when calling to_thread/to_task etc.</span>
<span class="sd">        2. Pass a container with all results when the limiter is not relevant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resume</span> <span class="o">=</span> <span class="n">noop</span>
    <span class="n">queue</span><span class="p">:</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="n">SingleConsumerAsyncQueue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">)</span>
    <span class="n">unfinished</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">pen_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_pending</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">set</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">max_concurrent_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_concurrent_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_IDLE_POOL_INSTANCES</span> <span class="k">if</span> <span class="n">max_concurrent</span> <span class="ow">is</span> <span class="n">NoValue</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_concurrent</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scheduler</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">resume</span>
        <span class="n">gen</span> <span class="o">=</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">AsyncGenerator</span><span class="p">)</span> <span class="k">else</span> <span class="nb">iter</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="n">is_async</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">AsyncGenerator</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">stopped</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pen</span> <span class="o">:=</span> <span class="k">await</span> <span class="n">anext</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_async</span> <span class="k">else</span> <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="n">pen_current</span><span class="p">:</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Waiting for the pending in which it is running would result in deadlock!&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="n">Pending</span><span class="p">):</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;Pending[T]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">await_for</span><span class="p">,</span> <span class="n">pen</span><span class="p">))</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pen</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
                <span class="n">unfinished</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">max_concurrent_</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                    <span class="n">waiter</span> <span class="o">=</span> <span class="n">create_async_waiter</span><span class="p">()</span>
                    <span class="n">resume</span> <span class="o">=</span> <span class="n">waiter</span><span class="o">.</span><span class="n">wake</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">waiter</span>
                    <span class="n">resume</span> <span class="o">=</span> <span class="n">noop</span>

    <span class="n">pen_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">scheduler</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">queue</span><span class="p">:</span>
            <span class="n">unfinished</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">pen</span>
            <span class="k">if</span> <span class="n">pen_</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unfinished</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">queue</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">max_concurrent_</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">unfinished</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_concurrent_</span><span class="p">:</span>
                    <span class="n">resume</span><span class="p">()</span>
        <span class="n">pen_</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">pen_</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">unfinished</span><span class="p">:</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">remove_done_callback</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cancel_unfinished</span><span class="p">:</span>
                <span class="n">pen</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s2">&quot;Cancelled by as_completed&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">CancelScope</span><span class="p">():</span>
            <span class="k">await</span> <span class="n">pen_</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.wait" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">wait</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#async_kernel.caller.Caller.wait" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">wait</span><span class="p">(</span>
    <span class="n"><span title="async_kernel.caller.Caller.wait(items)">items</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="collections.abc.Iterable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable">Iterable</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.wait(timeout)">timeout</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n"><span title="async_kernel.caller.Caller.wait(return_when)">return_when</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a></span><span class="p">[</span>
        <span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">,</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#tuple">tuple</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#set">set</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]],</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#set">set</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title=" Pending (async_kernel.pending.Pending)" href="../pending/#async_kernel.pending.Pending">Pending</a></span><span class="p">[</span><span class="n"><span title="async_kernel.typing.T">T</span></span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Wait for the results given by items to complete.</p>
<p>Returns two sets of the results: (done, pending).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.wait(items)" class="doc doc-heading doc-heading-parameter">              <b><code>items</code></b>
<a href="#async_kernel.caller.Caller.wait(items)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="collections.abc.Iterable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable">Iterable</a>[<a class="autorefs autorefs-external" title="collections.abc.Awaitable" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Awaitable">Awaitable</a>[<span title="async_kernel.typing.T">T</span>]]</code>)
          –
          <div class="doc-md-description">
            <p>An iterable of results to wait for.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.wait(timeout)" class="doc doc-heading doc-heading-parameter">              <b><code>timeout</code></b>
<a href="#async_kernel.caller.Caller.wait(timeout)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>The maximum time before returning.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.wait(return_when)" class="doc doc-heading doc-heading-parameter">              <b><code>return_when</code></b>
<a href="#async_kernel.caller.Caller.wait(return_when)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" title="typing.Literal" href="https://docs.python.org/3/library/typing.html#typing.Literal">Literal</a>[&#39;FIRST_COMPLETED&#39;, &#39;FIRST_EXCEPTION&#39;, &#39;ALL_COMPLETED&#39;]</code>, default:
                  <code>&#39;ALL_COMPLETED&#39;</code>
)
          –
          <div class="doc-md-description">
            <p>The same options as available for <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/asyncio-task.html#asyncio.wait">asyncio.wait</a>.</p>
          </div>
        </li>
    </ul>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</code></pre></div>
</details>        <p>Info:
    - This does not raise a TimeoutError!
    - Pendings that aren't done when the timeout occurs are returned in the second set.</p>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_when</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">,</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ALL_COMPLETED&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wait for the results given by items to complete.</span>

<span class="sd">    Returns two sets of the results: (done, pending).</span>

<span class="sd">    Args:</span>
<span class="sd">        items: An iterable of results to wait for.</span>
<span class="sd">        timeout: The maximum time before returning.</span>
<span class="sd">        return_when: The same options as available for [asyncio.wait][].</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        done, pending = await asyncio.wait(items)</span>
<span class="sd">        ```</span>
<span class="sd">    Info:</span>
<span class="sd">        - This does not raise a TimeoutError!</span>
<span class="sd">        - Pendings that aren&#39;t done when the timeout occurs are returned in the second set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pending</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Pending</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">done</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Pending</span><span class="p">):</span>
            <span class="n">done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">done</span><span class="p">()</span> <span class="k">else</span> <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">call_soon</span><span class="p">(</span><span class="n">await_for</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>
        <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>
    <span class="k">if</span> <span class="n">pending</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">anyio</span><span class="o">.</span><span class="n">move_on_after</span><span class="p">(</span><span class="n">timeout</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">pen</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">pending</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">cancel_unfinished</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">pending</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="n">done</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_COMPLETED&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="n">return_when</span> <span class="o">==</span> <span class="s2">&quot;FIRST_EXCEPTION&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pen</span><span class="o">.</span><span class="n">cancelled</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pen</span><span class="o">.</span><span class="n">exception</span><span class="p">()):</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">done</span><span class="p">,</span> <span class="n">pending</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="async_kernel.caller.Caller.create_pending_group" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">create_pending_group</span>


<a href="#async_kernel.caller.Caller.create_pending_group" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_pending_group</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n"><span title="async_kernel.caller.Caller.create_pending_group(shield)">shield</span></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new <a class="autorefs autorefs-internal" title=" PendingGroup" href="../pending/#async_kernel.pending.PendingGroup">PendingGroup</a> instance.</p>
<p>The pending group will wait for all pending created in its context to complete (except for those that opt out).
If any pending result in exception, the pending group and all registered pending are cancelled.
If the pending group context is cancelled or results in exception, all pending in the group are
also cancelled.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<h4 id="async_kernel.caller.Caller.create_pending_group(shield)" class="doc doc-heading doc-heading-parameter">              <b><code>shield</code></b>
<a href="#async_kernel.caller.Caller.create_pending_group(shield)" class="headerlink" title="Permanent link">&para;</a></h4>              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          –
          <div class="doc-md-description">
            <p>Shield the pending group from external cancellation.</p>
          </div>
        </li>
    </ul>
        <p>Usage:</p>
<pre><code>```python
async with Caller().create_pending_group() as pg:
    pg.caller.to_thread(my_func)
    ...
```
</code></pre>

          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/async_kernel/caller.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_pending_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">shield</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new [PendingGroup][async_kernel.pending.PendingGroup] instance.</span>

<span class="sd">    The pending group will wait for all pending created in its context to complete (except for those that opt out).</span>
<span class="sd">    If any pending result in exception, the pending group and all registered pending are cancelled.</span>
<span class="sd">    If the pending group context is cancelled or results in exception, all pending in the group are</span>
<span class="sd">    also cancelled.</span>

<span class="sd">    Args:</span>
<span class="sd">        shield: Shield the pending group from external cancellation.</span>

<span class="sd">    Usage:</span>

<span class="sd">        ```python</span>
<span class="sd">        async with Caller().create_pending_group() as pg:</span>
<span class="sd">            pg.caller.to_thread(my_func)</span>
<span class="sd">            ...</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PendingGroup</span><span class="p">(</span><span class="n">shield</span><span class="o">=</span><span class="n">shield</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 21, 2025 03:03:23 UTC"><span class="timeago" datetime="2025-08-21T03:03:23+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 21, 2025 03:03:23 UTC">2025-08-21</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="August 21, 2025 03:03:23 UTC"><span class="timeago" datetime="2025-08-21T03:03:23+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="August 21, 2025 03:03:23 UTC">2025-08-21</span>
  </span>

    
    
    
  </aside>





                 
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Modules">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Modules
              </div>
            </div>
          </a>
        
        
          
          <a href="../comm/" class="md-footer__link md-footer__link--next" aria-label="Next: comm">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                comm
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy;   2025-present
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "toc.follow", "navigation.top", "header.autohide", "navigation.footer", "search.suggest", "search.highlight", "navigation.instant", "navigation.indexes", "navigation.path"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>